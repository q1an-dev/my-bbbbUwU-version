        /* --- 全局与主题样式 --- */
        :root {
            --bg-color: #fce4ec;
            --primary-color: #ff80ab;
            --secondary-color: #f48fb1;
            --accent-color: #90caf9;
            --text-color: #444;
            --white-color: #fff;
            --border-radius: 18px;
            --phone-corner-radius: 0px;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --top-pinned-bg: #fff0f5;
            --online-status-color: #4CAF50;
        }

        html {
            height: 100%;
            overflow: hidden;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE and Edge */
        }
        html::-webkit-scrollbar {
            display: none; /* Chrome, Safari, and Opera */
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #fce4ec, #f8bbd0);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            overflow: hidden;
        }

        .phone-screen {
            width: 100%;
            max-width: 420px;
            height: 100%;
            max-height: 850px;
            background-color: var(--white-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-radius: var(--phone-corner-radius);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }


        .screen {
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 20px;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #eee;
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }

        .app-header .back-btn,
        .app-header .action-btn {
            background: none;
            border: none;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #cancel-multi-select-btn {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: var(--white-color) !important;
            background-color: var(--primary-color) !important;
            border-radius: 10px !important;
            padding: 5px 10px !important;
            width: auto !important;
            height: auto !important;
        }

        .app-header .action-btn-group {
            display: flex;
            align-items: center;
            gap: 7px;
        }

        .app-header .action-btn-group .action-btn {
            font-size: 28px;
            padding: 0;
            width: 40px;
            height: 40px;
            background-color: transparent;
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none; /* Ensure no border */
            cursor: pointer; /* Ensure cursor is pointer */
        }

        .app-header .action-btn-group .action-btn svg {
            width: 22px;
            height: 22px;
            stroke: var(--primary-color);
            stroke-width: 2;
            fill: none;
        }

        .app-header .action-btn img {
            width: 28px;
            height: 28px;
        }

        .app-header .title-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .app-header .title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }

        .app-header .subtitle {
            font-size: 12px;
            color: #888;
            display: flex;
            align-items: center;
            margin-top: 2px;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--online-status-color);
            margin-right: 5px;
        }

        .app-header .placeholder {
            width: 40px;
        }

        #home-screen {
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease-in-out;
            padding: 45px 5px 25px;
            /* New styles for swipe functionality */
           flex-direction: column;
           overflow: hidden; /* Hide overflow for the swiper */
        }
       .home-screen-swiper {
           display: flex;
           width: 200%; /* Two pages */
           flex: 1;
           overflow: hidden;
           transition: transform 0.4s ease-in-out;
       }
       .home-screen-page {
           width: 50%;
           display: flex;
           flex-direction: column;
           justify-content: flex-start;
           align-items: center;
       }
       .page-indicator {
           position: absolute;
           bottom: 160px; /* Adjust based on dock height */
           left: 50%;
           transform: translateX(-50%);
           display: flex;
           gap: 8px;
       }
       .page-indicator .dot {
           width: 8px;
           height: 8px;
           border-radius: 50%;
           background-color: rgba(0, 0, 0, 0.25); /* 浅灰色 */
           transition: background-color 0.3s;
       }
       .page-indicator .dot.active {
           background-color: rgba(0, 0, 0, 0.374); /* 深灰色 */
       }


        #home-screen.day-mode .satellite-oval,
        #home-screen.day-mode .widget-time,
        #home-screen.day-mode .widget-date,
        #home-screen.day-mode .widget-battery,
        #home-screen.day-mode .widget-signature,
        #home-screen.day-mode .app-icon .app-name {
            color: var(--white-color);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        .app-grid {
            width: 100%;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 15px;
            justify-content: center;
            align-content: flex-start;
            margin-top: 20px;
            height: calc(100% - 280px); /* Adjust height to fit better */
        }
        .app-grid-widget-container {
            grid-column: span 2;
            grid-row: span 2;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .app-grid-widget {
            width: 85%;
            height: 85%;
            background-color: transparent;
            border-radius: 30px;
            padding: 0; /* Remove padding */
            box-sizing: border-box;
            border: none; /* Remove border */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0; /* Remove gap */
            transition: transform 0.2s ease;
        }
        .app-grid-widget:hover {
            transform: none; /* Remove hover effect */
        }
        .app-grid-placeholder-widget {
            grid-column: 3 / 5;
            grid-row: 3 / 5;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 18px;
            border: 2px dashed rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: rgba(0,0,0,0.4);
        }
        .heart-photo-widget {
            grid-column: 3 / 5;
            grid-row: 3 / 5;
            width: 60%;
            height: auto;
            aspect-ratio: 83 / 95;
            justify-self: center;
            align-self: center;
            background-color: #F0F2F0; /* Polaroid paper color */
            padding: 12px 12px 35px 12px; /* Padding for frame */
            box-shadow: 0 5px 12px rgba(0,0,0,0.15); /* Shadow for lifting effect */
            border: 1px solid #DCDCDC; /* Hard edge */
            border-bottom-color: #B0B0B0;
            border-right-color: #B0B0B0;
            border-radius: 4px; /* Softer corners */
            transform: rotate(4deg);
            position: relative;
            background-image: none;
            clip-path: none;
            filter: none;
            cursor: pointer; /* Add cursor pointer */
            transition: transform 0.2s ease-in-out; /* Add transition */
        }
        .heart-photo-widget:hover {
            transform: rotate(2deg) scale(1.05); /* Add hover effect */
        }
        .heart-photo-widget::after {
            content: '';
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            bottom: 35px; /* Adjust to match padding */
            background-image: url('https://i.postimg.cc/XvFDdTKY/Smart-Select-20251013-023208.jpg');
            background-size: cover;
            background-position: center;
            /* Inner shadow for recessed look and bottom line */
            box-shadow: inset 0px 1px 4px rgba(0, 0, 0, 0.25);
            border-bottom: 1px solid #C5C2BE;
        }
        .widget-top-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
            color: rgba(0, 0, 0, 0.4);
        }
        .widget-status-text {
            font-size: 14px;
            font-weight: 600;
        }
        .widget-icons {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .widget-icons svg {
            width: 18px;
            height: 18px;
            fill: rgba(0, 0, 0, 0.4);
        }
        .widget-main-image-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .widget-main-image {
            width: 85%;
            padding-bottom: 85%; /* Creates a square aspect ratio */
            background-size: cover;
            background-position: center;
            border-radius: 18px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .widget-speech-bubble {
            position: absolute;
            top: 10px;
            right: 0px;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .widget-paw-button {
            background-color: #fff;
            border-radius: 20px;
            padding: 6px 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .widget-paw-button img {
            height: 20px;
            width: auto;
        }


        #peek-screen .time-widget,
        #peek-screen .time-widget .date,
        #peek-screen .app-icon .app-name {
            color: var(--white-color);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        }

        #peek-screen .time-widget {
            text-align: center;
            margin-bottom: 40px;
        }

        #peek-screen .time-widget .time {
            font-size: 72px;
            font-weight: 200;
            letter-spacing: 2px;
            line-height: 1;
        }

        #peek-screen .time-widget .date {
            font-size: 18px;
            font-weight: 400;
            opacity: 0.8;
            margin-top: 8px;
        }

        #peek-screen .app-grid {
            margin-top: 20px;
        }

        .dock {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            background-color: transparent;
            backdrop-filter: none;
            border-radius: var(--border-radius);
            margin: 0 20px;
            min-height: 80px;
            gap: 15px;
            flex-shrink: 0;
        }

        .app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            text-decoration: none;
        }

        .icon-img {
            width: 54px;
            height: 54px;
            border-radius: 15px;
            margin-bottom: 6px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
            object-fit: cover;
        }

        .app-icon:hover .icon-img {
            transform: translateY(-5px);
        }

        .app-icon .app-name {
            font-size: 12px;
            color: var(--text-color);
            font-weight: 500;
        }


        .content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }

        .placeholder-text {
            text-align: center;
            color: #aaa;
            margin-top: 50px;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-window {
            background: var(--white-color);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
            width: 85%;
            max-width: 340px;
            animation: slideUp 0.4s ease-out;
        }

        .modal-window h3 {
            margin-top: 0;
            text-align: center;
            color: var(--primary-color);
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        #message-edit-modal .modal-window {
            width: 90%;
            max-width: 400px;
        }

        #message-edit-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #fce4ec;
            border-radius: 10px;
            background-color: #fff;
            transition: border-color 0.3s;
            font-family: var(--font-family);
            font-size: 15px;
            resize: vertical; /* Allow vertical resizing */
        }

        #message-edit-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        #edit-group-member-modal,
        #create-member-for-group-modal {
            z-index: 102;
        }

        #edit-group-member-modal .avatar-preview,
        #create-member-for-group-modal .avatar-preview {
            width: 80px;
            height: 80px;
        }

        .context-menu {
            position: fixed;
            z-index: 1000;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            padding: 5px 0;
            animation: fadeIn 0.1s ease;
        }

        .context-menu-item {
            padding: 10px 20px;
            cursor: pointer;
        }

        .context-menu-item:hover {
            background-color: #f5f5f5;
        }

        .context-menu-item.danger {
            color: #e53935;
        }

        .action-sheet-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 200;
            display: none;
            align-items: flex-end;
            animation: fadeIn 0.3s ease;
        }

        .action-sheet-overlay.visible {
            display: flex;
        }

        .action-sheet {
            background: #f7f7f7;
            width: 100%;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 10px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            animation: slideUp 0.3s ease-out;
        }

        .action-sheet-button {
            width: 100%;
            background: white;
            border: none;
            padding: 15px;
            font-size: 16px;
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .action-sheet-button.danger {
            color: #e53935;
        }

        .action-sheet-button:last-child {
            margin-bottom: 0;
        }

        #chat-list-screen .content,
        #world-book-screen .content {
            padding: 10px 0 0 0;
        }

        .list-container {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .list-item {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .list-item:hover {
            background-color: #fdf6f8;
        }

        .chat-item.pinned {
            background-color: var(--top-pinned-bg);
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            flex-shrink: 0;
            background-color: #eee;
        }

        .group-avatar {
            border-radius: 10px;
        }

        .item-details {
            flex-grow: 1;
            overflow: hidden;
        }

        .item-details-row {
            display: flex;
            justify-content: space-between;
            /* align-items: center;  <-- 删除这一行 */
            align-items: flex-start; /* <-- 修改成这一行 */
        }



        .item-name {
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
        }

        .item-preview-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .item-preview {
            font-size: 14px;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-grow: 1;
        }

        .pin-badge {
            background-color: var(--primary-color);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 5px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        #chat-room-screen {
            background-size: cover;
            background-position: center;
        }

        #chat-room-screen .content {
            display: flex;
            flex-direction: column;
            padding: 0;
            padding-bottom: 10px;
            transition: padding-bottom 0.3s ease;
        }

        #chat-room-screen.multi-select-active .content {
            padding-bottom: 70px;
        }

        .message-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px 10px 0;
            scroll-behavior: smooth;
        }

        .message-wrapper {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
            transition: background-color 0.2s;
            flex-direction: column;
        }

        .message-wrapper.group-message {
            margin-bottom: 18px;
        }

        .message-wrapper.sent {
            align-items: flex-end;
        }

        .message-wrapper.received {
            align-items: flex-start;
        }

        .message-wrapper.system-notification {
            align-items: center;
        }

        .message-bubble-row {
            display: flex;
            width: 100%;
            align-items: flex-start;
        }

        .message-wrapper.sent .message-bubble-row {
            flex-direction: row-reverse;
        }

        .message-wrapper.multi-select-selected {
            background-color: rgba(144, 202, 249, 0.2);
            border-radius: var(--border-radius);
        }

        .message-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .group-nickname {
            position: absolute;
            top: -15px;
            font-size: 11px;
            color: #888;
            white-space: nowrap;
            width: 70px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }

        .message-time {
            font-size: 9px;
            color: #aaa;
            margin-top: 3px;
        }

        .message-bubble {
            max-width: 260px;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            word-wrap: break-word;
            line-height: 1.4;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            margin: 0 8px;
            cursor: pointer;
            font-size: 15px;
        }

        .message-bubble.sent {
            border-bottom-right-radius: 5px;
        }

        .message-bubble.received {
            border-bottom-left-radius: 5px;
        }

        .system-notification-bubble {
            background-color: rgba(200, 200, 200, 0.5);
            color: #666;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 10px;
            text-align: center;
        }

        /* --- 新增：撤回消息样式 --- */
        .withdrawn-message {
            color: #999;
            font-size: 12px;
            padding: 4px 10px;
            text-align: center;
            cursor: pointer; /* 新增：让提示可点击 */
            display: inline-block; /* 改为inline-block以适应内容宽度 */
            background-color: #e0e0e0; /* 新增：灰色背景 */
            border-radius: 10px; /* 新增：圆角 */
        }

        .withdrawn-content {
            font-size: 14px;
            color: #555;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 8px 12px;
            margin-top: 5px;
            border-radius: 10px;
            line-height: 1.6;
            max-width: calc(100% - 108px);
            display: none; /* 默认隐藏 */
            animation: fadeIn 0.3s ease;
            align-self: center; /* 居中显示 */
        }

        .withdrawn-content.active {
            display: block;
        }

        .image-bubble {
            max-width: 120px;
            border-radius: var(--border-radius);
            margin: 0 8px;
            padding: 4px;
            background-color: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .image-bubble img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: calc(var(--border-radius) - 4px);
        }

        .message-wrapper.sent .image-bubble {
            border-bottom-right-radius: 5px;
        }

        .message-wrapper.received .image-bubble {
            border-bottom-left-radius: 5px;
        }

        .voice-bubble {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            margin: 0 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 90px;
            max-width: 200px;
        }

        .message-wrapper.sent .voice-bubble {
            border-bottom-right-radius: 5px;
            flex-direction: row-reverse;
        }

        .message-wrapper.received .voice-bubble {
            border-bottom-left-radius: 5px;
        }

        .voice-bubble .play-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .voice-bubble .duration {
            font-size: 13px;
            margin: 0 8px;
            white-space: nowrap;
        }

        .message-wrapper.sent .play-icon {
            transform: scaleX(-1);
        }

        .voice-transcript {
            font-size: 14px;
            color: #555;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 8px 12px;
            margin-top: 5px;
            margin-left: 54px;
            margin-right: 54px;
            border-radius: 10px;
            line-height: 1.6;
            max-width: calc(100% - 108px);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .voice-transcript.active {
            display: block;
        }

        .message-wrapper.sent .voice-transcript {
            align-self: flex-end;
            margin-right: 54px;
            margin-left: auto;
        }

        .message-wrapper.received .voice-transcript {
            align-self: flex-start;
            margin-left: 54px;
            margin-right: auto;
        }

        .pv-card {
            width: 230px;
            aspect-ratio: 1 / 1;
            background-color: #f0f0f0;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            margin: 0 8px;
        }

        .message-wrapper.sent .pv-card {
            border-bottom-right-radius: 5px;
        }

        .message-wrapper.received .pv-card {
            border-bottom-left-radius: 5px;
        }

        .pv-card-image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: opacity 0.5s ease-in-out;
            z-index: 2;
        }

        .pv-card-image-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .pv-card-content {
            padding: 15px;
            height: 100%;
            overflow-y: auto;
            color: var(--text-color);
            line-height: 1.6;
            font-size: 15px;
            background-color: white;
            position: relative;
            z-index: 1;
        }

        .pv-card-footer {
            background: linear-gradient(to top, rgba(0, 0, 0, 0.6), transparent);
            color: white;
            padding: 20px 10px 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 3;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out;
        }

        .pv-card-footer.hidden {
            opacity: 0;
        }

        .pv-card-footer svg {
            width: 14px;
            height: 14px;
            fill: white;
            flex-shrink: 0;
        }

        .transfer-card {
            width: 240px;
            height: auto;
            border-radius: var(--border-radius);
            margin: 0 8px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            color: white;
        }

        .message-wrapper.sent .transfer-card {
            border-bottom-right-radius: 5px;
        }

        .message-wrapper.received .transfer-card {
            border-bottom-left-radius: 5px;
            cursor: pointer;
        }

        .transfer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            filter: blur(4px);
            transform: scale(1.1);
            z-index: 1;
        }

        .transfer-card.sent-transfer::before {
            background-image: url('https://i.postimg.cc/sxN893WF/IMG-20250712.png');
        }

        .transfer-card.received-transfer::before {
            background-image: url('https://i.postimg.cc/FzR8LY7g/IMG-20250712-170703.png');
        }

        .transfer-card .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 2;
            transition: background-color 0.5s ease;
        }

        .transfer-card.received .overlay {
            background-color: rgba(255, 182, 193, 0.4);
        }

        .transfer-card.returned .overlay {
            background-color: rgba(100, 100, 100, 0.5);
        }

        .transfer-content {
            position: relative;
            z-index: 3;
            padding: 20px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .transfer-title {
            font-size: 14px;
            margin: 0 0 5px 0;
            opacity: 0.9;
        }

        .transfer-amount {
            font-size: 28px;
            font-weight: bold;
            margin: 0;
        }

        .transfer-remark {
            font-size: 14px;
            margin-top: 10px;
            opacity: 0.9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .transfer-status {
            font-size: 12px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            opacity: 0.8;
        }

        .gift-card {
            width: 230px;
            background-color: #fff;
            border: 2px solid #333;
            border-radius: var(--border-radius);
            box-shadow: 4px 4px 0px #ddd;
            padding: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
            margin: 0 8px;
            position: relative;
            overflow: hidden;
        }

        .message-wrapper.sent .gift-card {
            border-bottom-right-radius: 5px;
        }

        .message-wrapper.received .gift-card {
            border-bottom-left-radius: 5px;
        }

        .gift-card-icon {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .gift-card-text {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            font-family: 'Comic Sans MS', 'Chalkduster', 'Handwriting', cursive;
        }

        .gift-card-description {
            font-size: 14px;
            color: #555;
            background-color: rgba(240, 240, 240, 0.9);
            padding: 8px 12px;
            margin-top: 5px;
            margin-left: 54px;
            margin-right: 54px;
            border-radius: 10px;
            line-height: 1.6;
            max-width: calc(100% - 108px);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .gift-card-description.active {
            display: block;
        }

        .message-wrapper.sent .gift-card-description {
            align-self: flex-end;
            margin-right: 54px;
            margin-left: auto;
        }

        .message-wrapper.received .gift-card-description {
            align-self: flex-start;
            margin-left: 54px;
            margin-right: auto;
        }

        .gift-card-received-stamp {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 14px;
            font-weight: bold;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 2px 6px;
            transform: rotate(15deg);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-family: 'Comic Sans MS', 'Chalkduster', 'Handwriting', cursive;
        }

        .gift-card.received .gift-card-received-stamp {
            opacity: 1;
        }

        .load-more-btn {
            background-color: #e0e0e0;
            color: #757575;
            border: none;
            padding: 8px 16px;
            margin: 10px auto;
            border-radius: 15px;
            cursor: pointer;
            display: block;
            font-size: 13px;
            font-weight: 500;
        }

        .load-more-btn:hover {
            background-color: #d1d1d1;
        }

        .typing-indicator {
            text-align: center;
            color: #aaa;
            font-style: italic;
            font-size: 14px;
            padding: 10px 0;
            display: none;
        }

        #sticker-bar {
            flex-shrink: 0;
            padding: 0 10px 5px;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            gap: 2px; /* 修改：将间距从 5px 缩小到 2px */
            overflow-x: auto; /* 新增：允许内容超出时横向滚动 */
            flex-wrap: nowrap; /* 新增：确保所有按钮在同一行，不换行 */
}

/* (可选) 新增：为了在某些浏览器上获得更好的视觉效果，可以隐藏滚动条 */
#sticker-bar::-webkit-scrollbar {
    display: none; /* 隐藏滚动条本身 */
}


        .sticker-bar-btn {
            background: none;
            border: none;
            padding: 5px;
            cursor: pointer;
        }

        .sticker-bar-btn svg {
            width: 28px;
            height: 28px;
            fill: #888;
        }

        /* Slightly enlarge image and cart icons for visual consistency */
        #image-recognition-btn svg,
        #gift-btn svg {
            width: 30px;
            height: 30px;
        }

        #sticker-modal, #chat-expansion-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 35%;
            max-height: 250px;
            background: #f7f7f7;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
            z-index: 25;
            display: none;
            flex-direction: column;
        }

        #sticker-modal.visible, #chat-expansion-panel.visible {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }

        #sticker-modal .header {
            padding: 10px 15px;
            font-weight: bold;
            color: var(--text-color);
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sticker-grid {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 15px;
        }

        .sticker-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        .sticker-item.is-managing {
            cursor: pointer;
        }

        .sticker-item.is-selected::after {
            content: '✓';
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: var(--primary-color);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .sticker-item.is-managing:not(.is-selected)::before {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid #ccc;
            background-color: rgba(255, 255, 255, 0.8);
        }
        .sticker-item img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .sticker-item span {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            text-align: center;
        }

        #add-sticker-modal .modal-window {
            max-width: 360px;
        }

        #sticker-preview {
            width: 100px;
            height: 100px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            background-color: #f9f9f9;
        }

        #sticker-preview img {
            max-width: 100%;
            max-height: 100%;
        }

        .chat-input-wrapper {
            flex-shrink: 0;
        }

        .message-input-area {
            display: flex;
            align-items: center;
            padding: 10px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            border-top: 1px solid #eee;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            gap: 10px;
            border-bottom-left-radius: var(--phone-corner-radius);
            border-bottom-right-radius: var(--phone-corner-radius);
            overflow: hidden;
        }

        .message-input-area input {
            flex-grow: 1;
            border: none;
            padding: 12px;
            border-radius: 18px;
            background-color: #f0f0f0;
        }

        .message-input-area input:focus {
            outline: none;
        }

        .message-input-area .icon-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .message-input-area .icon-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .message-input-area .icon-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .message-input-area .icon-btn.send-btn {
            font-size: 18px;
        }

        #multi-select-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: transparent;
            backdrop-filter: none;
            display: none;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            border-top: 1px solid #eee;
            z-index: 20;
            border-bottom-left-radius: var(--phone-corner-radius);
            border-bottom-right-radius: var(--phone-corner-radius);
            animation: slideUp 0.3s ease-out;
        }

        #multi-select-bar.visible {
            display: flex;
        }

        .settings-sidebar {
            position: absolute;
            top: 0;
            right: -100%;
            width: 80%;
            height: 100%;
            background: #fff;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            transition: right 0.4s ease-in-out;
            z-index: 101;
            display: flex;
            flex-direction: column;
        }

        .settings-sidebar.open {
            right: 0;
        }

        .settings-sidebar .header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            font-weight: bold;
            text-align: center;
            color: var(--primary-color);
        }

        .settings-sidebar .content {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .settings-sidebar .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .settings-sidebar .avatar-setting {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .settings-sidebar .avatar-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--secondary-color);
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #fce4ec;
            border-radius: 10px;
            background-color: #fff;
            transition: border-color 0.3s;
            font-family: var(--font-family);
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group.radio-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .form-group.radio-group label {
            margin-bottom: 0;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white-color);
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            box-shadow: 0 4px 15px rgba(255, 128, 171, 0.5);
        }

        label.btn-primary {
            color: var(--white-color) !important;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        .btn-secondary {
            background-color: var(--accent-color);
            color: var(--white-color);
            margin-bottom: 15px;
        }

        .btn-secondary:hover {
            background-color: #64b5f6;
            box-shadow: 0 4px 15px rgba(144, 202, 249, 0.5);
        }

        .btn-neutral {
            background-color: #bdbdbd;
            color: var(--white-color);
        }

        .btn-neutral:hover {
            background-color: #9e9e9e;
        }

        .btn-danger {
            background-color: #ef5350;
            color: white;
        }

        .btn .spinner {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-top-color: var(--white-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .btn.loading .spinner {
            display: block;
        }

        .btn.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .wallpaper-preview {
            width: 100%;
            aspect-ratio: 9 / 16;
            max-height: 400px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            background-size: cover;
            background-position: center;
            border: 3px dashed var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary-color);
            font-style: italic;
            background-color: #fff8fa;
        }

        .toast {
            position: absolute;
            top: -120px; /* Start off-screen */
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 380px;
            background-color: rgba(255, 255, 255, 0.88);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: #333;
            padding: 12px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            visibility: hidden;
            transition: top 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .toast.show {
            top: 20px; /* Slide down to this position */
            opacity: 1;
            visibility: visible;
        }

        /* --- 未读消息红点样式 --- */
.unread-badge {
    position: absolute; /* 关键：使用绝对定位 */
    top: 60%;          /* 距离顶部12px */
    right: 20px;        /* 距离右侧20px */
    background-color: #ff3b30;
    color: white;
    font-size: 12px;
    font-weight: 500;
    line-height: 18px;
    min-width: 18px;
    height: 18px;
    border-radius: 9px;
    padding: 0 5px;
    text-align: center;
    z-index: 2; /* 确保红点在其他元素之上 */

    /* 使用透明度和缩放来实现平滑的显示/隐藏，避免布局抖动 */
    opacity: 0;
    transform: translateY(-60%) scale(0.5);
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.unread-badge.visible {
    opacity: 1;
    transform: translateY(-60%) scale(1);
}
/* --- 样式添加结束 --- */


.unread-badge {
    background-color: #ff3b30; /* 鲜艳的红色 */
    color: white;
    font-size: 12px;
    font-weight: 500;
    line-height: 18px; /* 让文字垂直居中 */
    min-width: 18px;
    height: 18px;
    border-radius: 9px; /* 圆角 */
    padding: 0 5px; /* 左右留白，这样单个数字时也好看 */
    text-align: center;
    display: none; /* 默认隐藏 */
}

.unread-badge.visible {
    display: inline-block; /* 当有未读消息时显示 */
}
/* --- 样式添加结束 --- */

.item-time {
    font-size: 12px;
    color: #aaa;
    white-space: nowrap; /* 防止时间换行 */
}

        /* --- 这是您需要添加的代码 --- */

        /* 用于底部简单提示的样式 */
        .toast.simple {
            top: auto; /* 取消顶部的定位 */
            bottom: 90px; /* 直接定位在最终位置 */
            background-color: rgba(255, 255, 255, 0.7); /* 深色背景，更像系统提示 */
            color: white; /* 白色文字 */
            max-width: 250px; /* 可以让它窄一点 */
            backdrop-filter: none; /* 简单提示不需要毛玻璃效果 */
            -webkit-backdrop-filter: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15); /* 调整阴影 */
            /* 只对透明度进行过渡，实现淡入淡出 */
            transition: opacity 0.4s ease-out;
        }

        /* 简单提示显示时的位置 */
        .toast.simple.show {
            top: auto; /* 确保覆盖 .toast.show 的 top 样式 */
            /* bottom 属性不再需要，因为它已经在 .toast.simple 中设置好了 */
        }

        /* 简单提示不需要头像，让文字居中 */
        .toast.simple .toast-avatar {
            display: none;
        }
        .toast.simple .toast-content {
            text-align: center;
            width: 100%;
        }

        /* --- 添加代码结束 --- */


        /* --- 添加代码结束 --- */

        .toast-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            object-fit: cover;
            flex-shrink: 0;
            background-color: #eee;
        }

        .toast-content {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            gap: 2px;
        }

        .toast-name {
            font-weight: 600;
            font-size: 15px;
            color: #000;
        }

        .toast-message {
            font-size: 14px;
            color: #444;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #world-book-selection-modal,
        #invite-member-modal,
        #group-recipient-selection-modal,
        #global-pomodoro-world-book-selection-modal {
            z-index: 102;
        }

        #world-book-selection-modal .modal-window,
        #invite-member-modal .modal-window,
        #group-recipient-selection-modal .modal-window {
            width: 90%;
            max-width: 380px;
        }

        #world-book-selection-list,
        #invite-member-selection-list,
        #group-recipient-selection-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 40vh;
            overflow-y: auto;
        }

        .world-book-select-item,
        .invite-member-select-item,
        .group-recipient-select-item {
            display: flex;
            align-items: center;
            padding: 12px 5px;
            border-bottom: 1px solid #f0f0f0;
        }

        .world-book-select-item:last-child,
        .invite-member-select-item:last-child,
        .group-recipient-select-item:last-child {
            border-bottom: none;
        }

        .world-book-select-item input[type="checkbox"],
        .invite-member-select-item input[type="checkbox"],
        .group-recipient-select-item input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }

        .world-book-select-item label,
        .invite-member-select-item label,
        .group-recipient-select-item label {
            font-weight: 500;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .invite-member-select-item img,
        .group-recipient-select-item img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* --- Group Chat Specific Styles --- */
        .member-selection-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
            max-height: 40vh;
            overflow-y: auto;
        }

        .member-selection-item {
            display: flex;
            align-items: center;
            padding: 10px 5px;
            border-bottom: 1px solid #f0f0f0;
        }

        .member-selection-item:last-child {
            border-bottom: none;
        }

        .member-selection-item input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .member-selection-item img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }

        .member-selection-item label {
            font-weight: 500;
            color: var(--text-color);
        }

        #group-settings-sidebar .group-avatar-setting {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        #group-settings-sidebar .group-avatar-preview {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid var(--primary-color);
            cursor: pointer;
        }

        #group-settings-sidebar .group-members-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        #group-settings-sidebar .group-member,
        #group-settings-sidebar .add-member-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        #group-settings-sidebar .group-member img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 5px;
            border: 2px solid #eee;
        }

        #group-settings-sidebar .add-member-btn .add-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #ccc;
            margin-bottom: 5px;
            transition: all 0.2s ease;
        }

        #group-settings-sidebar .add-member-btn:hover .add-icon {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        #group-settings-sidebar .group-member span,
        #group-settings-sidebar .add-member-btn span {
            font-size: 12px;
            text-align: center;
            color: var(--text-color);
        }

        #customize-screen .icon-custom-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        #customize-screen .icon-custom-item:last-child {
            border-bottom: none;
        }

        #customize-screen .icon-preview {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            object-fit: cover;
            flex-shrink: 0;
        }

        #customize-screen .icon-details {
            flex-grow: 1;
        }

        #customize-screen .icon-details p {
            margin: 0 0 8px 0;
            font-weight: 600;
        }

        #customize-screen .icon-details input {
            width: calc(100% - 70px);
        }

        #customize-screen .reset-icon-btn {
            background: #e0e0e0;
            color: #555;
            border: none;
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 10px;
        }

        #peek-app-icons-settings .icon-preview {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            object-fit: cover;
            flex-shrink: 0;
        }

        /* 主页自定义小部件样式 (*/
.home-widget-container {
    position: relative;
    width: 230px; /* 增加了容器宽度，给加宽后的小椭圆留出空间 */
    height: 150px;
    margin: 10px auto 30px; /* 稍微增加顶部距离 */
    display: flex;
    justify-content: center;
    align-items: center;
}

.central-circle {
    width: 95px;
    height: 95px;
    border-radius: 50%;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    background-size: cover;
    background-position: center;
    transition: transform 0.3s ease;
}
.central-circle:hover {
    transform: scale(1.05);
}

/* 这是旁边4个小椭圆的通用样式 (美化版) */
.satellite-oval {
    position: absolute;
    width: 120px; /* 宽度 */
    height: 45px; /* 高度 */
    background-color: rgba(255, 255, 255, 0.2); /* 背景 */
    backdrop-filter: blur(8px);
    border-radius: 18px; /* 边缘圆角 */
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08); /* 阴影 */
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: flex-start;
    padding: 0 8px; /* 内边距 */
    gap: 10px; /* 图片和文字之间的空隙 */
    font-size: 11px; /* 字体大小 */
    color: var(--text-color);
    font-weight: 405; /* 字体粗细 */
    transition: all 0.3s ease;
    overflow: hidden;
}
.satellite-oval:hover {
    transform: scale(1.08);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.satellite-emoji {
    font-size: 16px;
    width: 25px;
    height: 25px;
    display: grid;
    place-items: center;
    flex-shrink: 0;
    cursor: text;
    border-radius: 50%;
    transition: background-color 0.2s;
}

.satellite-text {
    flex-grow: 1;
    text-align: left;
    line-height: 1.4;
    white-space: normal;
    cursor: text;
    transition: background-color 0.2s;
    border-radius: 5px;
    padding: 2px 4px;
    margin: -2px -4px;
}

[contenteditable]:focus {
    outline: 2px solid var(--accent-color);
    background-color: rgba(144, 202, 249, 0.2);
}

/* 分别定义4个小椭圆的位置 (调整了位置以适应新宽度) */
.oval-top-left {
    top: 20px; /* 向上移一点 */
    left: -62px; /* 向左移更多 */
}
.oval-top-right {
    top: 20px;
    right: -62px;
}
.oval-bottom-left {
    bottom: 20px; /* 向下移一点 */
    left: -62px;
}
.oval-bottom-right {
    bottom: 20px;
    right: -62px;
}

/* --- 电池小部件的样式 --- */
.widget-battery {
    color: #666; /* 字体颜色，和日期保持一致 */
    font-family: var(--font-family);
    text-shadow: 0 5px 3px rgba(0,0,0,0.1);
    font-size: 17px; /* 字体大小，和日期保持一致 */

    position: absolute; /* 绝对定位 */
    display: flex; /* 使用flex布局让图标和文字对齐 */
    align-items: center; /* 垂直居中对齐 */

    /* 电池的位置 */
    /* 我们把它放在右下角椭圆的下面，和日期对称 */
    bottom: -15px; /* 高低 */
    right: -45px; /* 左右 */
}

/* 电池图标和文字之间的间距 */
.widget-battery svg {
    margin-right: 5px;
}


/* --- 时间和日期的样式 --- */

.widget-time {
    color: var(--text-color); /* 字体颜色 */
    font-family: var(--font-family);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1); /* 加一点点阴影，更有质感 */

    position: absolute;
    left: 50%; /* 先把它推到容器中间 */
    transform: translateX(-50%);
    bottom: -20px; /* 数字越大越往上，越小越往下，甚至可以是负数哦 */

    /* 时间的字体大小 */
    font-size: 25px;
    font-weight: 600; /* 字体粗细 */
}

.widget-signature {
    color: var(--text-color);
    font-family: var(--font-family);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: -50px; /* Position it below the time widget */
    font-size: 14px;
    font-weight: 500;
    width: 90%;
    max-width: 300px;
    background-color: transparent;
    border: none;
    outline: none;
    text-align: center;
    padding: 5px;
    border-radius: 8px;
    transition: background-color 0.3s;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.widget-signature:focus {
    background-color: rgba(0, 0, 0, 0.05);
    white-space: normal;
    overflow: visible;
}

.widget-signature:empty::before {
    content: attr(placeholder);
    color: #999;
    pointer-events: none;
}

#home-screen.day-mode .widget-signature:focus {
     background-color: rgba(255, 255, 255, 0.1);
}

#home-screen.day-mode .widget-signature:empty::before {
    color: rgba(255, 255, 255, 0.7);
}

.widget-date {
    color: #666; /* 日期的颜色，淡一点 */
    font-family: var(--font-family);
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);

    position: absolute; /* 同样用绝对定位 */
    width: 130px; /*
    text-align: center; /* 文字居中对齐 */

    /* 日期的位置 */
    /* 我们把它放在左下角椭圆的下面 */
    bottom: -15px; /* 高低 */
    left: -45px; /*左右 */

    /* 这个是日期的字体大小 */
    font-size: 15px;
}
        /* --- Tutorial Screen Styles --- */
        .tutorial-item {
            margin-bottom: 15px;
            border: 1px solid #fce4ec;
            border-radius: 12px;
            overflow: hidden;
            background-color: #fff8fa;
        }

        .tutorial-header {
            padding: 12px 18px;
            font-weight: 600;
            color: var(--secondary-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tutorial-header::after {
            content: '▼';
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .tutorial-item.open .tutorial-header::after {
            transform: rotate(180deg);
        }

        .tutorial-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease;
            padding: 0 10px;
        }

        .tutorial-item.open .tutorial-content {
            padding: 10px 10px;
            /* A large value to ensure it expands to fit the content */
            max-height: 5000px;
        }

        .tutorial-content img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            display: block;
        }

    /* --- Peek Unlock Screen (Social Media) --- */
    #peek-unlock-screen {
        background-color: #fff;
        color: #262626;
    }

    #peek-unlock-screen .app-header .title,
    #peek-unlock-screen .app-header .back-btn,
    #peek-unlock-screen .app-header .action-btn {
        color: #262626;
    }

    #peek-unlock-screen .content {
        padding: 0;
    }

    .unlock-profile-header {
        display: flex;
        align-items: center;
        padding: 16px;
    }

    .unlock-profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-right: 28px;
        object-fit: cover;
    }

    .unlock-profile-info {
        flex-grow: 1;
    }

    .unlock-profile-username {
        font-size: 22px;
        font-weight: 300;
        margin: 0 0 4px 0;
    }

    .unlock-profile-handle {
        font-size: 14px;
        color: #8e8e8e;
        margin: 0;
    }

    .unlock-profile-bio {
        padding: 0 16px 16px;
        font-size: 14px;
        line-height: 1.4;
    }

    .unlock-profile-stats {
        display: flex;
        justify-content: space-around;
        text-align: center;
        padding: 12px 0;
        border-top: 1px solid #efefef;
        border-bottom: 1px solid #efefef;
    }

    .unlock-profile-stat {
        font-size: 14px;
    }

    .unlock-profile-stat .count {
        font-weight: 600;
        display: block;
    }

    .unlock-profile-stat .label {
        color: #8e8e8e;
    }

    .unlock-post-feed {
        padding: 0;
        background-color: #f9f9f9;
    }

    .unlock-post-card {
        background-color: #fff;
        border-bottom: 1px solid #efefef;
        padding: 16px;
    }

    .unlock-post-card-header {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
    }

    .unlock-post-card-header img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 12px;
    }

    .unlock-post-card-author-info {
        display: flex;
        flex-direction: column;
    }

    .unlock-post-card-author-info .username {
        font-weight: 600;
        font-size: 15px;
    }

    .unlock-post-card-author-info .timestamp {
        font-size: 12px;
        color: #8e8e8e;
    }

    .unlock-post-card-content {
        font-size: 15px;
        line-height: 1.6;
        margin-bottom: 12px;
    }


    .unlock-post-card-actions {
        display: flex;
        justify-content: space-around;
        color: #8e8e8e;
        font-size: 13px;
        padding-top: 12px;
        border-top: 1px solid #f5f5f5;
    }

    .unlock-post-card-actions .action {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .unlock-post-card-actions .action svg {
        width: 20px;
        height: 20px;
        fill: #8e8e8e;
    }

    /* --- Peek Album Styles (偷看相册样式) --- */
    .album-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2px;
        padding: 2px;
    }

    .album-photo {
        position: relative;
        width: 100%;
        padding-bottom: 100%; /* 1:1 Aspect Ratio */
        background-color: #e9ecef;
        cursor: pointer;
    }

    .album-photo img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .video-indicator {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .video-indicator svg {
        width: 14px;
        height: 14px;
        fill: white;
        margin-left: 2px;
    }

    #peek-photo-modal .modal-window {
        width: 90%;
        max-width: 420px; /* 确保弹窗不会超过手机屏幕宽度 */
        padding: 15px;
        background-color: #fff;
        border-radius: 15px;
    }

    #peek-photo-image-container {
        width: 100%;
        max-height: 70vh;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        background-color: #f0f0f0;
        border-radius: 10px;
        overflow: hidden;
    }

    #peek-photo-image-container img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    #peek-photo-description {
        font-size: 15px;
        line-height: 1.6;
        color: #333;
        text-align: left;
        white-space: pre-wrap;
        padding: 0 5px 5px 5px;
        border-top: 1px solid #eee;
        margin-top: 15px;
        padding-top: 15px;
    }
        /* Peek Screen Specific Styles */
        #peek-messages-screen .list-item:hover,
        #peek-conversation-screen {
            background-color: #f8f9fa;
        }

        #peek-messages-screen .app-header,
        #peek-conversation-screen .app-header {
            background-color: rgba(248, 249, 250, 0.85);
            border-bottom-color: rgba(0, 0, 0, 0.08);
        }

        #peek-messages-screen .back-btn,
        #peek-conversation-screen .back-btn,
        #peek-messages-screen .title,
        #peek-conversation-screen .title {
            color: #212529;
        }

        #peek-messages-screen .chat-avatar {
            border-radius: 12px;
        }

        #peek-messages-screen .app-header .action-btn,
        #peek-conversation-screen .app-header .action-btn,
        #peek-cart-screen .app-header .action-btn,
        #peek-transfer-station-screen .app-header .action-btn,
        #peek-browser-screen .app-header .action-btn,
        #peek-drafts-screen .app-header .action-btn {
            color: #212529;
        }

        #peek-conversation-screen .message-bubble {
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        #peek-conversation-screen .message-bubble.received {
            background-color: #e9ecef;
            color: #343a40;
        }

        #peek-conversation-screen .message-bubble.sent {
            background-color: #007bff;
            color: white;
        }

        /* --- Peek Memos Screen --- */
        #peek-memos-screen {
            background-color: #f9f9f9;
        }

        #peek-memos-screen .app-header .title,
        #peek-memos-screen .app-header .back-btn,
        #peek-memos-screen .app-header .action-btn {
            color: #212529;
        }

        #peek-memos-screen .content {
            padding: 0;
        }

        #peek-memos-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .memo-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .memo-item:hover {
            background-color: #f0f0f0;
        }

        .memo-item-title {
            font-weight: 600;
            font-size: 16px;
            color: #333;
            margin: 0 0 5px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .memo-item-preview {
            font-size: 14px;
            color: #777;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- Peek Memo Detail Screen --- */
        #peek-memo-detail-screen {
            background-color: #fff;
        }

        #peek-memo-detail-screen .app-header .title,
        #peek-memo-detail-screen .app-header .back-btn,
        #peek-memo-detail-screen .app-header .action-btn {
            color: #212529;
        }
        
        #peek-memo-detail-screen .content {
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        #memo-title-input {
            border: none;
            padding: 20px;
            font-size: 22px;
            font-weight: bold;
            outline: none;
            border-bottom: 1px solid #eee;
        }

        #memo-content-textarea {
            flex-grow: 1;
            border: none;
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            outline: none;
            resize: none;
            font-family: var(--font-family);
        }

        /* --- Peek Cart Screen --- */
        #peek-cart-screen {
            background-color: #f8f9fa;
        }

        #peek-cart-screen .app-header .title,
        #peek-cart-screen .app-header .back-btn {
            color: #212529;
        }

        #peek-cart-screen .content {
            padding: 0;
        }

        .cart-item-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background-color: #fff;
            border-bottom: 1px solid #eee;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
            margin-right: 15px;
            background-color: #eee;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        .cart-item-title {
            font-weight: 600;
            font-size: 15px;
            color: #333;
            margin: 0 0 5px 0;
        }

        .cart-item-spec {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
        }

        .cart-item-price {
            font-size: 16px;
            font-weight: bold;
            color: #e53935;
        }
        
        .cart-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
            background-color: #fff;
            border-top: 1px solid #eee;
            flex-shrink: 0;
        }

        .cart-total-price {
            font-size: 18px;
            font-weight: bold;
            color: #e53935;
        }
        
        .cart-total-price .label {
            font-size: 14px;
            font-weight: normal;
            color: #333;
        }

        .checkout-btn {
            background-color: #e53935;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* --- Peek Transfer Station Screen --- */
        #peek-transfer-station-screen {
            background-color: #ededed; /* WeChat-like background */
        }

        #peek-transfer-station-screen .app-header {
            background-color: #ededed;
            border-bottom: 1px solid #dcdcdc;
        }

        #peek-transfer-station-screen .app-header .title,
        #peek-transfer-station-screen .app-header .back-btn {
            color: #000;
        }

        #peek-transfer-station-screen .content {
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        .transfer-station-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .transfer-station-input-area {
            flex-shrink: 0;
            padding: 8px;
            background-color: #f7f7f7;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
        }

        .transfer-station-input-area .fake-input {
            flex-grow: 1;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            height: 36px;
        }

        .transfer-station-input-area .plus-btn {
            width: 36px;
            height: 36px;
            margin-left: 8px;
            background-image: url('https://i.postimg.cc/8PLqF514/icons8-48.png');
            background-size: 24px;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #f7f7f7;
            border: none;
        }

        /* --- Peek Browser Screen --- */
        #peek-browser-screen {
            background-color: #ffffff;
        }

        #peek-browser-screen .app-header .title,
        #peek-browser-screen .app-header .back-btn {
            color: #212529;
        }

        #peek-browser-screen .content {
            padding: 15px 0;
        }

        .browser-history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .browser-history-item {
            padding: 12px 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .browser-history-item:last-child {
            border-bottom: none;
        }

        .history-item-title {
            font-weight: 500;
            font-size: 16px;
            color: #0056b3; /* A standard link blue */
            margin: 0 0 4px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item-url {
            font-size: 13px;
            color: #555;
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item-annotation {
            font-size: 14px;
            color: #444;
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 8px;
            line-height: 1.5;
            position: relative;
        }
        
        .history-item-annotation::before {
            content: '批注：';
            font-weight: 600;
            color: #888;
            font-size: 12px;
            display: block;
            margin-bottom: 4px;
        }

        /* --- Peek Drafts Screen --- */
        #peek-drafts-screen {
            background-color: #fff;
            flex-direction: column;
        }

        #peek-drafts-screen .app-header .title,
        #peek-drafts-screen .app-header .back-btn {
            color: #212529;
        }

        #peek-drafts-screen .content {
            padding: 30px 25px;
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.8;
            color: #333;
            flex-grow: 1;
            overflow-y: auto;
        }

        .draft-paper {
            background-color: #fdfdfd;
            border: 1px solid #eee;
            padding: 25px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .draft-to {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .draft-content {
            font-size: 17px;
            white-space: pre-wrap; /* To preserve line breaks */
        }

        .strikethrough {
            text-decoration: line-through;
            color: #999;
        }

        /* --- Chat Expansion Panel --- */
        .expansion-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .expansion-item-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            transition: background-color 0.2s;
        }
        
        .expansion-item:hover .expansion-item-icon {
            background-color: #f5f5f5;
        }

        .expansion-item-icon svg {
            width: 32px;
            height: 32px;
            fill: #555;
        }

        .expansion-item-name {
            font-size: 13px;
            color: #666;
        }

        /* --- Memory Journal Screen --- */
        #memory-journal-screen .content {
            padding: 15px;
            background-color: #f9f9f9;
        }

        .journal-card {
            background-color: #fdfdfd;
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s ease;
        }

        .journal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .journal-card-title {
            font-size: 18px;
            font-weight: bold;
            font-family: 'Georgia', 'Times New Roman', serif;
            color: #333;
            flex-grow: 1;
            padding-right: 60px; /* Space for buttons */
        }

        .journal-card-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .journal-card-actions .action-icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .journal-card-actions .action-icon-btn:hover {
            color: var(--primary-color);
        }

        .journal-card-actions .action-icon-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .journal-card-actions .favorite-journal-btn .star-solid {
            fill: #FFD700; /* Gold */
            display: none;
        }

        .journal-card-actions .favorite-journal-btn.favorited .star-solid {
            display: inline;
        }

        .journal-card-actions .favorite-journal-btn.favorited .star-outline {
            display: none;
        }

        .journal-card-content {
            font-family: 'Georgia', 'Times New Roman', serif;
            font-size: 16px;
            line-height: 1.7;
            color: #444;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, margin-top 0.4s ease-out, padding-top 0.4s ease-out;
            white-space: pre-wrap;
            margin-top: 0;
            padding-top: 0;
            border-top: 1px solid #f0f0f0;
        }

        .journal-card.expanded .journal-card-content {
            max-height: 1000px; /* A large enough value */
            margin-top: 15px;
            padding-top: 15px;
        }

        .journal-card-content.editing {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            min-height: 150px;
            background: #fff;
            max-height: 1000px !important; /* Ensure it's visible when editing */
        }

        .journal-card-footer {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 10px;
            height: 0;
            opacity: 0;
            transition: height 0.4s ease-out, opacity 0.4s ease-out;
        }

        .journal-card.expanded .journal-card-footer {
            height: auto;
            opacity: 1;
        }

        .journal-card-range {
            font-size: 12px;
            color: #aaa;
        }
        
        /* --- 论坛 --- */
        /* --- 论坛分享卡片 --- */
.forum-share-card {
    width: 250px; /* 卡片宽度 */
    background-color: #ffffff;
    border-radius: var(--border-radius);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    padding: 12px 15px;
    cursor: pointer;
    border: 1px solid #f0f0f0;
    margin: 0 8px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.forum-share-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
}

.forum-share-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #888;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid #f5f5f5;
}

.forum-share-header svg {
    width: 18px;
    height: 18px;
    fill: #aaa;
    flex-shrink: 0;
}

.forum-share-content .forum-share-title {
    font-size: 15px;
    font-weight: 600;
    color: #333;
    margin: 0 0 5px 0;
    line-height: 1.4;
    /* 最多显示两行，超出部分显示省略号 */
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.forum-share-content .forum-share-summary {
    font-size: 13px;
    color: #666;
    line-height: 1.5;
    /* 最多显示三行 */
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}

#forum-binding-modal .modal-window {
    max-width: 380px; /* 弹窗可以稍微宽一点 */
}

.forum-binding-tabs {
    display: flex;
    border-bottom: 2px solid #eee;
    margin-bottom: 15px;
}

.forum-binding-tabs .tab-btn {
    flex: 1;
    padding: 10px 15px;
    background: none;
    border: none;
    font-size: 15px;
    font-weight: 500;
    color: #888;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s ease-in-out;
}

.forum-binding-tabs .tab-btn:hover {
    color: var(--primary-color);
}

.forum-binding-tabs .tab-btn.active {
    color: var(--primary-color);
    font-weight: 600;
    border-bottom-color: var(--primary-color);
}

#forum-binding-content-wrapper {
    max-height: 50vh; /* 限制内容区域最大高度，超出则出现滚动条 */
    overflow-y: auto; /* 垂直方向溢出时显示滚动条 */
    padding-right: 10px; /* 为滚动条留出空间，防止内容被遮挡 */
}

.forum-binding-content {
    display: none; /* 默认隐藏所有内容面板 */
}

.forum-binding-content.active {
    display: block; /* 只显示激活的内容面板 */
}

.binding-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.binding-list-item {
    display: flex;
    align-items: center;
    padding: 12px 5px;
    border-bottom: 1px solid #f2f2f2;
}

.binding-list-item:last-child {
    border-bottom: none;
}

.binding-list-item input[type="checkbox"] {
    margin-right: 15px;
    width: 18px;
    height: 18px;
    flex-shrink: 0;
}

.binding-list-item label {
    font-size: 15px;
    color: var(--text-color);
    flex-grow: 1;
    cursor: pointer;
}

/* --- 论坛帖子样式 --- */
#forum-posts-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.forum-post-card {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
}

.forum-post-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
}

.forum-post-card .post-title {
    font-size: 18px;
    font-weight: 600;
    color: #333;
    margin: 0 0 8px 0;
}

.forum-post-card .post-summary {
    font-size: 14px;
    color: #888;
    margin: 0 0 12px 0;
    border-left: 3px solid var(--primary-color, #ff80ab);
    padding-left: 10px;
}

.forum-post-card .post-content {
    font-size: 15px;
    color: #555;
    line-height: 1.75;
    white-space: pre-wrap; /* 这很重要，能保留AI生成内容里的换行 */
    display: none; /* 默认隐藏详细内容 */
}

/* 当卡片被点击时，展开详细内容 */
.forum-post-card.expanded .post-content {
    display: block;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
}

/* --- Forum Post Detail Screen --- */
#forum-post-detail-screen {
    background-color: #f9f9f9;
}

#forum-post-detail-screen .content {
    padding: 0;
}

.post-detail-card {
    background-color: #fff;
    margin: 15px;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.post-author-info {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.post-author-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    margin-right: 12px;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: bold;
    flex-shrink: 0;
}

.post-author-name {
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

.post-detail-title {
    font-size: 22px;
    font-weight: 700;
    margin: 0 0 20px 0;
    line-height: 1.4;
}

.post-detail-content {
    font-size: 17px;
    line-height: 1.8;
    color: #444;
    white-space: pre-wrap;
    margin-bottom: 25px;
}

.post-actions {
    display: flex;
    justify-content: space-around;
    padding-top: 15px;
    border-top: 1px solid #f0f0f0;
}

.post-action-item {
    display: flex;
    align-items: center;
    gap: 6px;
    color: #666;
    font-size: 14px;
}

.post-action-item svg {
    width: 22px;
    height: 22px;
    fill: #888;
}

/* --- 论坛详情页新样式 --- */
#forum-post-detail-screen {
    background-color: #f0f2f5; /* 类似贴吧和社交媒体的浅灰色背景 */
}

#forum-post-detail-screen .content {
    padding: 10px; /* 页面边距 */
}

.post-detail-container {
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    margin-bottom: 10px;
    overflow: hidden;
}

.post-detail-main {
    padding: 15px;
}

.post-author-info {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
}

.author-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: bold;
    margin-right: 12px;
    flex-shrink: 0;
}

.author-details {
    display: flex;
    flex-direction: column;
}

.author-name {
    font-size: 15px;
    font-weight: 600;
    color: #333;
}

.post-meta-data {
    font-size: 12px;
    color: #999;
}

.post-detail-title {
    font-size: 20px;
    font-weight: 700;
    margin: 0 0 15px 0;
    line-height: 1.4;
    color: #1a1a1a;
}

.post-detail-content-body {
    font-size: 16px;
    line-height: 1.75;
    color: #333;
    white-space: pre-wrap;
    padding-bottom: 15px;
    border-bottom: 1px solid #f0f0f0;
}

.post-detail-actions {
    display: flex;
    justify-content: space-around;
    padding-top: 10px;
}

.post-detail-actions .action-item {
    display: flex;
    align-items: center;
    gap: 6px;
    color: #666;
    font-size: 14px;
    cursor: pointer;
    padding: 5px 10px;
    border-radius: 5px;
    transition: background-color 0.2s;
}

.post-detail-actions .action-item:hover {
    background-color: #f5f5f5;
}

.post-detail-actions .action-item svg {
    width: 20px;
    height: 20px;
    fill: #888;
}

/* --- 评论区样式 --- */
.comments-section {
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    padding: 15px;
}

.comments-header {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    padding-bottom: 10px;
    border-bottom: 1px solid #f0f0f0;
    margin-bottom: 10px;
}

.comment-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.comment-item {
    display: flex;
    padding: 12px 0;
    border-bottom: 1px solid #f5f5f5;
}

.comment-item:last-child {
    border-bottom: none;
}

.comment-author-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: var(--accent-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    margin-right: 12px;
    flex-shrink: 0;
}

.comment-body {
    flex-grow: 1;
}

.comment-author-name {
    font-size: 14px;
    font-weight: 600;
    color: #555;
}

.comment-content {
    font-size: 15px;
    color: #333;
    margin-top: 4px;
    line-height: 1.6;
}

.comment-timestamp {
    font-size: 12px;
    color: #aaa;
    margin-top: 6px;
}

/* --- 新的分离式柔和风格论坛搜索栏 --- */

/* 这是整个搜索区域的容器，我们让它透明，只用来布局 */
.forum-search-bar {
    display: flex;
    align-items: center;
    gap: 12px; /* 增大输入框和按钮之间的空隙，让它们彻底分开 */
    margin-bottom: 20px;
    width: 100%; /* 你可以在这里调整整个搜索栏的宽度，比如改成 90% 或者 350px */

    /* 核心改动：把之前的所有视觉样式（背景、边框、阴影）都去掉 */
    background-color: transparent;
    backdrop-filter: none;
    border-radius: 0;
    border: none;
    box-shadow: none;
    padding: 0; /* 现在不需要内边距了 */
}

/* 现在，我们单独给输入框加上样式，让它自己看起来像个完整的输入栏 */
#forum-search-input {
    flex-grow: 1; /* 让它自动占据大部分空间 */
    min-width: 0; /* 允许输入框在flex布局中无限缩小，防止溢出 */
    border: 1px solid rgba(255, 192, 203, 0.3); /* 一个非常淡的粉色边框 */
    background-color: rgba(255, 255, 255, 0.7); /* 半透明白底 */
    backdrop-filter: blur(8px);
    padding: 12px 18px; /* 调整内边距让输入框更高更舒服 */
    font-size: 15px;
    border-radius: 22px; /* 非常圆润的边角 */
    outline: none;
    color: var(--text-color, #444);
    box-shadow: 0 2px 10px rgba(200, 150, 160, 0.1); /* 淡淡的粉色阴影 */
    transition: box-shadow 0.3s ease, border-color 0.3s ease; /* 增加点击时的过渡效果 */
}

#forum-search-input:focus {
    border-color: rgba(255, 128, 171, 0.5); /* 点击输入框时，边框变成更明显的粉色 */
    box-shadow: 0 3px 15px rgba(255, 128, 171, 0.15); /* 阴影也带一点点粉色 */
}

#forum-search-input::placeholder {
    color: #b0aab3;
}

/* 单独给按钮设置样式，让它们看起来是独立的圆形按钮，并且没有边框 */
.forum-search-bar .action-btn {
    flex-shrink: 0;
    width: 42px;  /* 按钮稍微大一点点，更可爱 */
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%; /* 圆形 */
    background-color: rgba(255, 255, 255, 0.7); /* 和输入框一样的背景 */
    backdrop-filter: blur(8px);
    box-shadow: 0 2px 10px rgba(200, 150, 160, 0.1); /* 和输入框一样的阴影 */
    border: 1px solid rgba(255, 192, 203, 0.3); /* 和输入框一样的淡粉色边框 */
    transition: all 0.2s ease;
    cursor: pointer;

/* 图标颜色 */
.forum-search-bar .action-btn svg {
    fill: var(--primary-color, #ff80ab);
}

/* 鼠标悬停和点击时的效果 */
.forum-search-bar .action-btn:hover {
    transform: translateY(-2px); /* 轻轻向上浮动一点 */
    box-shadow: 0 4px 12px rgba(200, 150, 160, 0.15);
    background-color: rgba(255, 255, 255, 0.9);
}

.forum-search-bar .action-btn:active {
    transform: translateY(0); /* 点击时按下去 */
    box-shadow: 0 1px 6px rgba(200, 150, 160, 0.12);
}


}
/* --- 新增：折叠面板样式 --- */
.collapsible-section {
    background-color: #fff8fa;
    border: 1px solid #fce4ec;
    border-radius: 12px;
    margin-bottom: 15px;
    overflow: hidden; /* 防止内容溢出圆角 */
    transition: all 0.3s ease-in-out;
}

.collapsible-header {
    padding: 10px 15px; /* 调整内边距 */
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none; /* 防止选中文本 */
}
.category-toggle-area {
    flex-grow: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px; /* 增加点击区域 */
}
.category-select-area {
    padding-right: 10px;
    display: flex;
    align-items: center;
}

.collapsible-header h4 {
    margin: 0;
    font-size: 16px;
    color: var(--primary-color);
}

.collapsible-arrow {
    font-size: 14px;
    color: var(--secondary-color);
    transition: transform 0.3s ease-in-out;
}

.collapsible-content {
    max-height: 0; /* 默认折叠 */
    overflow: hidden;
    transition: max-height 0.4s ease-in-out;
    padding: 0 20px; /* 左右留出边距 */
}

/* 当 .collapsible-section 拥有 .open 类时应用的样式 */
.collapsible-section.open .collapsible-content {
    max-height: 5000px; /* 一个足够大的值来完全显示内容 */
    padding: 0 20px 20px; /* 展开时恢复底部内边距 */
}

.collapsible-section.open .collapsible-arrow {
    transform: rotate(180deg); /* 箭头旋转 */
}
/* --- 新增样式结束 --- */
.message-time {
     display: none !important;
}

 
 
/* --- Peek Steps App Styles (偷看步数应用样式) --- */
#peek-steps-screen {
    background-color: #f0f2f5;
    color: #1c1e21;
}


#peek-steps-screen .app-header {
    background-color: #f0f2f5;
    border-bottom: 1px solid #dcdcdc;
}

#peek-steps-screen .app-header .title,
#peek-steps-screen .app-header .back-btn {
    color: #1c1e21;
}

#peek-steps-screen .content {
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    flex-grow: 1;
    overflow-y: auto;
}

.steps-header {
    display: flex;
    align-items: center;
    width: 100%;
    margin-bottom: 30px;
    padding: 0 10px;
}

.steps-header-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    margin-right: 15px;
}

.steps-header-name {
    font-size: 20px;
    font-weight: 600;
}

.steps-progress-container {
    width: 220px;
    height: 220px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 35px;
    flex-shrink: 0; /* 防止在flex布局中被压缩 */
}

.steps-progress-circle {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(
        #4CAF50 0deg,
        #4CAF50 calc(3.6deg * var(--steps-percentage, 0)),
        #e6e6e6 calc(3.6deg * var(--steps-percentage, 0)),
        #e6e6e6 360deg
    );
    transition: background 0.5s ease-in-out;
}

.steps-progress-inner {
    position: absolute;
    width: 85%;
    height: 85%;
    background-color: #f0f2f5;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.steps-count {
    font-size: 42px;
    font-weight: bold;
    color: #4CAF50;
}

.steps-label {
    font-size: 14px;
    color: #65676b;
    margin-top: 5px;
}

.steps-module {
    width: 100%;
    background-color: #fff;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}

.steps-module-title {
    font-size: 16px;
    font-weight: 600;
    margin: 0 0 12px 0;
    padding-bottom: 10px;
    border-bottom: 1px solid #f0f0f0;
}

.activity-track-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.activity-track-item {
    font-size: 15px;
    color: #333;
    padding: 8px 0;
}

.steps-annotation {
    width: 100%;
    background-color: #fff;
    border-radius: 12px;
    padding: 15px;
    margin-top: 15px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    font-size: 14px;
    color: #555;
    line-height: 1.6;
    font-style: italic;
}
/* --- 世界书分类样式 --- */
.world-book-category-title {
padding: 10px 20px 5px 20px;
font-size: 16px;
font-weight: 600;
color: var(--secondary-color);
background-color: #fff8fa;
border-bottom: 1px solid #fce4ec;
border-top: 1px solid #fce4ec;
margin-top: 10px;
}

#world-book-list-container > .world-book-category-title:first-child {
margin-top: 0;
border-top: none;
}

/* --- 世界书分类选择样式 --- */
.world-book-category-group {
    border-bottom: 1px solid #f0f0f0;
    margin-bottom: 5px;
}
.world-book-category-group:last-child {
    border-bottom: none;
}

.world-book-category-header {
    display: flex;
    align-items: center;
    padding: 12px 5px;
    cursor: pointer;
    user-select: none;
}

.world-book-category-header .category-checkbox {
    margin-right: 15px;
    width: 20px;
    height: 20px;
}

.world-book-category-header .category-name {
    font-weight: 600;
    color: var(--primary-color);
    flex-grow: 1;
}

.world-book-category-header .category-arrow {
    font-size: 12px;
    transition: transform 0.3s ease;
}

.world-book-category-group.open .category-arrow {
    transform: rotate(180deg);
}

.world-book-items-list {
    list-style: none;
    padding: 0 0 0 25px; /* 左侧缩进 */
    margin: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease-in-out;
}

.world-book-category-group.open .world-book-items-list {
    max-height: 1000px; /* 一个足够大的值 */
    padding-bottom: 10px;
}
/* --- 聊天室顶栏按钮优化 --- */
#chat-room-header-default .action-btn-group {
    gap: 4px; /* 减小按钮之间的间距 */
}

#chat-room-header-default .action-btn-group .action-btn {
    width: 34px;  /* 缩小按钮宽度 */
    height: 34px; /* 缩小按钮高度 */
    padding: 5px; /* 调整内边距以适应新尺寸 */
}

#chat-room-header-default .action-btn-group .action-btn img {
    width: 24px;  /* 缩小图标宽度 */
    height: 24px; /* 缩小图标高度 */
}

/* --- 表情包分类样式 (v3 - 匹配截图最终版) --- */

/* 修复Bug 1：增大弹窗高度，释放空间 */
#sticker-modal {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 45%; /* 增大高度 */
    max-height: 380px; /* 增大最大高度 */
    background: #f7f7f7;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
    z-index: 25;
    display: none;
    flex-direction: column;
}

/* 修复Bug 1：iOS风格三栏式头部 (缩小字体) */
#sticker-modal .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 15px; /* 适当的内边距 */
    height: 44px; /* 固定头部高度 */
    box-sizing: border-box;
    border-bottom: 1px solid #eee;
    flex-shrink: 0;
}
#sticker-modal .header .header-left {
    display: flex;
    align-items: center;
}

#sticker-modal .header .title {
    font-weight: 700; /* 加粗字体让标题更突出 */
    color: var(--primary-color); /* 使用小章鱼主色 */
    font-size: 16px; /* 稍微增大字体 */
    margin: 0; /* 确保没有默认margin */
    text-shadow: 0 1px 2px rgba(255, 128, 171, 0.1); /* 轻微的文字阴影 */
}
#sticker-modal .header .header-right {
    display: flex;
    gap: 6px; /* 调整间距让按钮更紧凑 */
    align-items: center;
}
#sticker-modal .panel-btn {
    background: rgba(255, 255, 255, 0.8); /* 半透明白色背景 */
    border: 1px solid var(--primary-color); /* 使用小章鱼主色边框 */
    color: var(--primary-color); /* 使用小章鱼主色文字 */
    font-size: 13px; /* 保持紧凑字体 */
    font-weight: 600; /* 保持字体粗细 */
    padding: 6px 12px; /* 保持紧凑padding */
    border-radius: 15px; /* 圆润的圆角，但不要太大 */
    cursor: pointer;
    transition: all 0.2s ease; /* 平滑过渡 */
    min-width: 44px; /* 最小点击区域 */
    height: 32px; /* 固定高度确保对齐 */
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 1px 6px rgba(255, 128, 171, 0.2); /* 小章鱼配色的轻微阴影 */
}

#sticker-modal .panel-btn:hover {
    background: var(--primary-color); /* 悬停时使用主色背景 */
    color: white; /* 悬停时文字变白 */
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(255, 128, 171, 0.3); /* 悬停时阴影加强 */
}

#sticker-modal .panel-btn:active {
    transform: translateY(0);
    box-shadow: 0 1px 4px rgba(255, 128, 171, 0.2);
    background: var(--secondary-color); /* 点击时使用次要色 */
    color: white;
}

/* 特殊状态按钮样式 - 使用小章鱼配色 */
#sticker-modal .panel-btn.btn-primary {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

#sticker-modal .panel-btn.btn-primary:hover {
    background: var(--secondary-color);
    border-color: var(--secondary-color);
    box-shadow: 0 3px 12px rgba(244, 143, 177, 0.4);
}

#sticker-modal .panel-btn.btn-danger {
    background: #FF6B6B; /* 温和的红色 */
    color: white;
    border-color: #FF6B6B;
}

#sticker-modal .panel-btn.btn-danger:hover {
    background: #FF5252; /* 悬停时深一点的红色 */
    border-color: #FF5252;
    box-shadow: 0 3px 12px rgba(255, 107, 107, 0.4);
}

/* 分类标签栏 (匹配 image_aef7d4.jpg) */
#sticker-category-tabs {
    display: flex;
    overflow-x: auto;
    padding: 0 15px;
    border-bottom: 1px solid #eee;
    gap: 20px;
    flex-shrink: 0;
    -ms-overflow-style: none;
    scrollbar-width: none;
}
#sticker-category-tabs::-webkit-scrollbar { display: none; }
#sticker-category-tabs .tab-item {
    padding: 10px 0 8px 0;
    font-size: 15px;
    color: #888;
    cursor: pointer;
    white-space: nowrap;
    border-bottom: 2px solid transparent;
    transition: all 0.2s ease;
}
#sticker-category-tabs .tab-item.active {
    color: var(--primary-color);
    font-weight: 600;
    border-bottom-color: var(--primary-color);
}

/* 搜索框 (匹配 image_aef7d4.jpg) */
#sticker-search-container {
    padding: 12px 15px;
    flex-shrink: 0;
}
#sticker-search-input {
    width: 100%;
    padding: 12px 16px;
    border-radius: 10px;
    border: none;
    background: #f0f0f0;
    font-size: 14px;
    -webkit-appearance: none;
}
#sticker-search-input:focus {
    outline: none;
    background: #e9e9e9;
}

/* 表情网格 (修复Bug 1: 确保可滚动) */
.sticker-grid {
    flex-grow: 1; /* 占据剩余所有空间 */
    overflow-y: auto;
    padding: 15px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 15px;
}

/* 修复Bug 2: 管理模式底栏样式 (匹配 image_c7fbc3.png) */
#sticker-manage-bar {
    display: none; /* 默认隐藏 */
    flex-direction: row;
    justify-content: flex-end; /* 修改：将控件组移动到右侧 */
    gap: 20px; /* 新增：在"全选"和"删除"之间增加间距 */
    align-items: center;
    padding: 15px 20px; /* 增加padding */
    padding-bottom: calc(15px + env(safe-area-inset-bottom)); /* 适配 iPhone X */
    border-top: 1px solid #e8e8e8;
    background: #fafafa;
    flex-shrink: 0;
    min-height: 60px; /* 增加高度以适应36px的按钮和合适的padding */
    width: 100%; /* 确保占满宽度 */
    box-sizing: border-box; /* 确保padding不影响总宽度 */
}
#sticker-manage-bar label {
    display: flex;
    align-items: center;
    gap: 12px; /* 增加复选框和文字的间距 */
    color: #333;
    font-size: 15px;
    font-weight: 500;
    height: 40px; /* 增加高度到40px */
    margin: 0; /* 确保没有默认margin */
}
#sticker-manage-bar #delete-selected-stickers-btn {
    width: auto;
    height: 40px; /* 与新的label高度一致 */
    padding: 0 32px; /* 增加padding让按钮更宽 */
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 20px; /* 圆角设计，匹配高度 */
    font-size: 15px;
    font-weight: 600;
    min-width: 270px; /* 修复：按照要求设置为200px，让按钮更长更和谐 */
    background: var(--primary-color); /* 使用小章鱼的主色 */
    color: white;
    border: none;
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(255, 128, 171, 0.3); /* 小章鱼配色的阴影 */
}

#sticker-manage-bar #delete-selected-stickers-btn:hover {
    background: var(--secondary-color); /* 悬停时使用次要色 */
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 128, 171, 0.4);
}

#sticker-manage-bar #delete-selected-stickers-btn:disabled {
    background: #ccc; /* 禁用状态 */
    color: #999;
    box-shadow: none;
    transform: none;
}

/* 修复Bug 3: 分类管理弹窗 (匹配 image_aef794.jpg / image_c7ffbf.png) */
#sticker-category-manager-modal .form-group {
    margin-bottom: 10px;
}
#sticker-category-manager-modal .form-group input {
    background-color: #f0f0f0;
    border: 1px solid #f0f0f0;
    padding: 12px;
}
#sticker-category-manager-modal .form-group input:focus {
    background-color: #fff;
    border: 1px solid var(--primary-color);
}
#sticker-category-manager-modal .btn-primary {
    padding: 12px 18px;
    height: 46px; /* 匹配输入框高度 */
}
#existing-categories-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 40vh;
    overflow-y: auto;
    border-top: 1px solid #f0f0f0;
    margin-top: 25px;
    padding-top: 25px;
}
#existing-categories-list .category-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border-radius: 10px;
    background-color: #fff;
    border: 1px solid #f0f0f0;
}
#existing-categories-list .category-name {
    font-size: 15px;
    font-weight: 500;
    color: #333;
}
#existing-categories-list .category-delete-btn {
    background: #f0f0f0;
    border: none;
    color: #ef5350;
    cursor: pointer;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    font-weight: bold;
    font-size: 16px;
    line-height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* (Bug 3 核心修复) 隐藏默认分类的操作按钮 */
#existing-categories-list .category-item[data-category="全部"] .category-delete-btn,
#existing-categories-list .category-item[data-category="未分类"] .category-delete-btn {
    display: none;
}
/* (Bug 3 核心修复) 隐藏默认分类的列表项 (匹配 image_c7ffbf.png) */
#existing-categories-list .category-item[data-category="全部"],
#existing-categories-list .category-item[data-category="未分类"] {
    display: none;
}

/* 修复: 上传弹窗按钮间距 (匹配 image_aefafb.png) */
#add-sticker-form p {
    margin: 15px 0 15px;
}
#add-sticker-form .btn-secondary {
    margin-bottom: 10px;
}

/* 优化: 上传界面间距 - 让表单更紧凑 */
#add-sticker-form .form-group {
    margin-bottom: 12px; /* 进一步减小到12px */
}
#add-sticker-form .form-group label {
    margin-bottom: 4px; /* 进一步减小到4px */
}
#add-sticker-form .form-group:last-of-type {
    margin-bottom: 8px; /* 最后一个表单组间距更小 */
}

/* 优化: 批量导入弹窗的间距 */
#batch-add-sticker-form .form-group {
    margin-bottom: 20px;
}
#batch-add-sticker-form .form-group:last-of-type {
    margin-bottom: 15px; /* 减少分类选择与按钮之间的间距 */
}
#batch-add-sticker-form .btn-primary {
    margin-top: 8px; /* 微调按钮间距 */
}

/* iOS风格的分隔符 */
.or-divider {
    position: relative;
    text-align: center;
    margin: 20px 0 15px;
    color: #8e8e93;
    font-size: 14px;
    font-weight: 400;
}

.or-divider::before,
.or-divider::after {
    content: '';
    position: absolute;
    top: 50%;
    width: calc(50% - 30px);
    height: 1px;
    background: #e8e8e8;
}

.or-divider::before {
    left: 0;
}

.or-divider::after {
    right: 0;
}

/* --- 存储分析详情列表样式 --- */
.storage-detail-item {
    display: flex;
    align-items: center;
    padding: 12px 8px;
    border-bottom: 1px solid #f0f0f0;
}
.storage-detail-item:last-child {
    border-bottom: none;
}
.storage-color-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 15px;
    flex-shrink: 0;
}
.storage-detail-info {
    flex-grow: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
}
.storage-detail-name {
    font-size: 16px;
    color: #333;
    font-weight: 500;
}
.storage-detail-size {
    font-size: 15px;
    color: #666;
    text-align: right;
}
.storage-detail-percentage {
    font-size: 12px;
    color: #999;
    width: 50px;
    text-align: right;
    flex-shrink: 0;
}
        /* --- 引用消息样式 --- */
        #reply-preview-bar {
            display: none; /* 默认隐藏 */
            padding: 8px 12px;
            background-color: rgba(240, 240, 240, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            animation: fadeIn 0.2s ease-out;
        }

        #reply-preview-bar.visible {
            display: flex;
        }

        .reply-preview-content {
            flex-grow: 1;
            overflow: hidden;
            border-left: 3px solid var(--primary-color);
            padding-left: 8px;
        }

        .reply-preview-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-color);
            display: block;
        }

        .reply-preview-text {
            font-size: 14px;
            color: #666;
            margin: 2px 0 0 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #cancel-reply-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: #999;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }

        .quoted-message {
            background-color: rgba(0, 0, 0, 0.04);
            padding: 6px 10px;
            border-radius: 10px;
            margin-bottom: 6px;
            border-left: 3px solid var(--secondary-color);
        }

        .quoted-sender {
            font-size: 13px;
            font-weight: 600;
            color: var(--secondary-color);
            display: block;
        }

        .quoted-text {
            font-size: 14px;
            color: #555;
            margin: 2px 0 0 0;
            white-space: pre-wrap; /* Allow line breaks */
            word-wrap: break-word;
            /* Limit to 3 lines with ellipsis */
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* --- Pomodoro (番茄钟) Styles --- */
        #pomodoro-screen {
            background: var(--white-color); /* Match other app screens */
            color: #333;
            flex-direction: column;
        }


        #pomodoro-screen .content {
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .task-list-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-card {
            background: var(--white-color); /* 使用白色背景以突出卡片 */
            border: 1px solid #f5f5f5; /* 添加一个非常浅的边框 */
            border-radius: 12px; /* 恢复圆角，使其看起来像卡片 */
            padding: 18px; /* 统一内边距 */
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04); /* 添加微妙的阴影以营造悬浮感 */
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .task-card:hover {
            transform: translateY(-2px); /* 悬停时轻微上浮 */
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08); /* 悬停时阴影加深 */
        }

        .task-card-info {
            flex-grow: 1;
        }

        .task-card-title {
            font-size: 16px; /* 标题字号稍小 */
            font-weight: 500; /* 字体变细 */
            margin: 0 0 8px 0; /* 增加与详情的间距 */
            color: #333;
        }

        .task-card-details {
            font-size: 14px; /* 详情字号稍大 */
            color: #888; /* 颜色变浅 */
        }

        .task-card-start-btn {
            background-color: transparent; /* 透明背景 */
            color: var(--primary-color); /* 主题色文字 */
            border: 1px solid var(--primary-color); /* 主题色描边 */
            border-radius: 20px; /* 更圆润的按钮 */
            padding: 8px 18px; /* 调整按钮大小 */
            font-weight: 500; /* 字体稍细 */
            cursor: pointer;
            flex-shrink: 0;
            margin-left: 15px;
            transition: all 0.2s ease; /* 平滑过渡 */
        }

        .task-card-start-btn:hover {
            background-color: var(--primary-color); /* 悬停时填充背景 */
            color: white; /* 文字变白 */
        }

        /* Create Task Modal Styles */
        #pomodoro-create-modal .modal-window {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #pomodoro-create-modal .form-group {
            margin-bottom: 18px;
        }

        #pomodoro-create-modal .radio-group-pills {
            display: flex;
            border: 1px solid #ddd;
            border-radius: 12px;
            overflow: hidden;
        }

        #pomodoro-create-modal .radio-group-pills label {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            background-color: transparent;
            color: #555;
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
        }

        #pomodoro-create-modal .radio-group-pills input[type="radio"] {
            display: none;
        }

        #pomodoro-create-modal .radio-group-pills input[type="radio"]:checked + label {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 128, 171, 0.4);
        }

        #pomodoro-duration-options {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, margin-top 0.4s ease-in-out;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        #pomodoro-duration-options.visible {
            max-height: 200px; /* A large enough value */
            margin-top: 15px;
        }

        #pomodoro-duration-options .duration-pill {
            flex-grow: 1;
            background-color: #f0f0f0;
            border: none;
            border-radius: 10px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s, color 0.2s;
        }

        #pomodoro-duration-options .duration-pill.active {
            background-color: var(--accent-color);
            color: white;
        }

        #pomodoro-custom-duration-input {
            width: 100%;
            margin-top: 10px;
            display: none; /* Initially hidden */
        }
        /* --- Pomodoro Focus Screen Styles --- */
        #pomodoro-focus-screen {
            background: var(--white-color);
            color: var(--text-color);
            flex-direction: column;
        }

        #pomodoro-focus-screen .app-header {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #eee;
        }

        #pomodoro-focus-screen .app-header .back-btn,
        #pomodoro-focus-screen .app-header .title {
            color: var(--text-color);
            text-shadow: none;
        }

        #pomodoro-focus-screen .content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Push timer up and controls down */
            align-items: center;
            flex-grow: 1;
        }

        .focus-timer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1; /* Take up available space */
            text-align: center;
        }

        .focus-task-title {
            font-size: 22px;
            font-weight: 500;
            color: #555;
            margin: 0 0 25px 0;
        }

        .focus-timer-display {
            font-size: 80px;
            font-weight: 700;
            line-height: 1;
            color: #333;
        }

        .focus-timer-mode {
            font-size: 16px;
            color: #888;
            margin-top: 10px;
        }

        .focus-total-time {
            font-size: 14px;
            color: #aaa;
            margin-top: 15px;
        }

        .focus-bottom-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 320px; /* Limit width for better spacing */
            padding: 20px 0 calc(20px + env(safe-area-inset-bottom));
            flex-shrink: 0;
        }
        
        .focus-controls-group {
            display: flex;
            gap: 20px;
        }

        .focus-bottom-controls .control-btn {
            background: transparent;
            border: none;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            padding: 8px;
            border-radius: 50%;
        }

        .focus-bottom-controls .control-btn:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .focus-bottom-controls .control-btn svg {
            width: 32px;
            height: 32px;
        }

        .focus-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }

        .focus-footer {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .focus-message-bubble {
            background-color: #f0f0f0;
            border-radius: 12px;
            padding: 15px 20px;
            width: 90%;
            max-width: 340px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            color: #333;
            font-size: 15px;
            /* --- 新增：动画样式 --- */
            opacity: 0;
            transform: translateY(15px) scale(0.95);
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); /* 一个有弹性的过渡效果 */
            pointer-events: none; /* 隐藏时不可交互 */
        }

        .focus-message-bubble.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
            visibility: visible;
            pointer-events: auto; /* 显示时可交互 */
        }

        .focus-message-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #f0f0f0;
        }
        /* --- NEW: Swipe to delete styles for task cards (Corrected) --- */
        .task-card-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: 12px; /* Match task-card border-radius */
        }

        .task-card {
            transition: transform 0.3s ease-in-out;
            will-change: transform;
            background-color: var(--white-color); /* Ensure it has a background */
            z-index: 2; /* Keep card above delete button */
            position: relative; /* Establishes stacking context */
        }

        .task-card-delete-btn {
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 100%;
            background-color: #ef5350; /* Danger color */
            color: white;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1; /* Positioned behind the card */
        }

        .task-card-wrapper.is-swiped .task-card {
            transform: translateX(-80px);
        }

        /* --- Pomodoro Settings Sidebar Styles --- */
        #pomodoro-settings-sidebar {
            background: rgba(245, 245, 245, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        #pomodoro-settings-sidebar .header {
            color: #333;
            font-weight: 600;
            border-bottom-color: rgba(0,0,0,0.08);
        }

        #pomodoro-settings-sidebar .form-group label {
            color: #555;
            font-weight: 500;
        }

        #pomodoro-settings-sidebar .form-group input,
        #pomodoro-settings-sidebar .form-group select {
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            font-size: 15px;
        }

        #pomodoro-settings-sidebar .form-group input:focus,
        #pomodoro-settings-sidebar .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 128, 171, 0.2);
        }

        #pomodoro-settings-sidebar hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 25px 0;
        }

        /* --- Pomodoro Certificate Styles --- */
        #pomodoro-certificate-modal .modal-window {
            background: linear-gradient(135deg, #fff8f9, #fff0f3);
            border: 1px solid var(--primary-color);
            box-shadow: 0 8px 25px rgba(255, 128, 171, 0.2);
        }

        #pomodoro-certificate-modal h3 {
            font-family: 'Georgia', 'Times New Roman', serif;
            font-size: 24px;
            color: var(--primary-color);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        #pomodoro-certificate-content {
            border-color: rgba(255, 128, 171, 0.5);
            text-align: left;
            padding: 20px 25px;
        }

        #pomodoro-certificate-content p {
            font-size: 16px;
            color: #555;
            margin: 10px 0;
            line-height: 1.6;
        }

        #pomodoro-certificate-content p strong {
            color: var(--secondary-color);
            font-weight: 600;
        }

        /* --- Pomodoro Record Card in Chat (New Style) --- */
        .pomodoro-record-card {
            width: 230px;
            background-color: #fff;
            border: 2px solid #333;
            border-radius: var(--border-radius);
            box-shadow: 4px 4px 0px #ddd;
            padding: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
            margin: 0 8px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .pomodoro-record-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }

        .pomodoro-record-icon {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .pomodoro-record-body .task-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            font-family: 'Comic Sans MS', 'Chalkduster', 'Handwriting', cursive;
        }

        .pomodoro-record-details {
            font-size: 14px;
            color: #555;
            background-color: rgba(240, 240, 240, 0.9);
            padding: 8px 12px;
            margin-top: 10px;
            border-radius: 10px;
            line-height: 1.6;
            display: none; /* 默认隐藏 */
            animation: fadeIn 0.3s ease;
            white-space: nowrap; /* 不换行 */
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .pomodoro-record-details.active {
            display: flex;
        }

        /* --- New INS-Style Widget --- */
        .ins-widget {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            padding: 10px; /* Add some padding */
            gap: 5px;
            box-sizing: border-box;
        }

        .ins-widget-row {
            display: flex;
            width: 100%;
            align-items: center;
        }

        .ins-widget-row.user {
            justify-content: flex-start;
        }

        .ins-widget-row.character {
            justify-content: flex-end;
        }

        .ins-widget-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            border: 2px solid white; /* 头像边框 */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15); /* 头像阴影 */
        }

        .ins-widget-bubble {
            position: relative;
            background-color: #fff;
            border-radius: 15px;
            padding: 6px 10px;
            font-size: 12px; /* 气泡字体大小 */
            color: #333;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
            max-width: 70%;
        }

        .ins-widget-row.user .ins-widget-bubble {
            margin-left: 12px;
        }

        .ins-widget-row.character .ins-widget-bubble {
            margin-right: 12px;
        }

        /* Bubble tail */
        .ins-widget-bubble::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        /* User bubble tail (left) */
        .ins-widget-row.user .ins-widget-bubble::after {
            top: 50%;
            left: -5.5px; /* 尾巴位置 */
            margin-top: -4px; /* 尾巴位置 */
            border-width: 4px 6px 4px 0; /* 尾巴大小 */
            border-color: transparent #fff transparent transparent;
        }

        /* Character bubble tail (right) */
        .ins-widget-row.character .ins-widget-bubble::after {
            top: 50%;
            right: -5.5px; /* 尾巴位置 */
            margin-top: -6px; /* 尾巴位置 */
            border-width: 6px 0 6px 8px; /* 尾巴大小 */
            border-color: transparent transparent transparent #fff;
        }

        .ins-widget-divider {
            width: 90%;
            text-align: center;
            border-bottom: 1.5px dashed #d3d3d3;
            line-height: 0.1em;
            margin: 12px 0;
        }

        .ins-widget-divider span {
            background: transparent;
            padding: 0 10px;
            color: #b0b0b0;
            font-size: 14px;
            font-weight: bold;
        }
/* --- 世界书批量选择模式样式 --- */
#world-book-multi-select-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    border-top: 1px solid #eee;
    z-index: 20;
    animation: slideUp 0.3s ease-out;
}

.world-book-item.is-selecting {
    cursor: pointer;
}

.world-book-item.selected::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 15px;
    transform: translateY(-50%);
    background-color: var(--primary-color);
    color: white;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.world-book-item.selected {
    padding-left: 50px !important;
    background-color: #fff0f5;
}


.collapsible-header .category-checkbox {
    margin-right: 15px;
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

.collapsible-header h4 {
    flex-grow: 1;
}
</head>

<body>
<svg width="0" height="0" style="position:absolute;">
  <defs>
    <clipPath id="heart-clip" clipPathUnits="objectBoundingBox">
      <path d="M0.5,1 C0.1,0.8,0,0.45,0.5,0.2 C1,0.45,0.9,0.8,0.5,1 Z" />
    </clipPath>
  </defs>
</svg>
<div class="phone-screen">
    <div id="home-screen" class="screen active"></div>
    <div id="chat-list-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="home-screen">‹</button>
            <div class="title-container">
                <h1 class="title">聊天</h1>
            </div>
            <div class="action-btn-group">
                <button class="action-btn" id="create-group-btn" title="群聊">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </button>
                <button class="action-btn" id="import-character-card-btn" title="导入">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                </button>
                <button class="action-btn" id="add-chat-btn">+</button>
            </div>
        </header>
        <main class="content">
            <ul class="list-container" id="chat-list-container"></ul>
            <div class="placeholder-text" id="no-chats-placeholder" style="display: none;">
                <p>还没有聊天对象哦~</p>
                <p>点击右上角的“+”创建一个吧！</p>
            </div>
        </main>
    </div>
    <div id="chat-room-screen" class="screen">
        <header class="app-header" id="chat-room-header-default">
            <button class="back-btn" data-target="chat-list-screen">‹</button>
            <div class="title-container">
                <h1 class="title" id="chat-room-title">...</h1>
                <div class="subtitle" id="chat-room-subtitle">
                    <div class="online-indicator"></div>
                    <span id="chat-room-status-text">在线</span>
                </div>
            </div>
            <div class="action-btn-group">
                <button class="action-btn" id="peek-btn">
                    <img src="https://i.postimg.cc/m2DRpk7v/chan-39.png" alt="偷看" style="width: 28px; height: 28px;">
                </button>
                <button class="action-btn" id="chat-settings-btn"><img src="https://i.postimg.cc/nhwP4pQy/chan-73.png"
                                                                       alt="设置"></button>
            </div>
        </header>
        <header class="app-header" id="chat-room-header-select" style="display: none;">
            <button class="action-btn" id="cancel-multi-select-btn">取消</button>
            <div class="title-container">
                <h1 class="title" id="multi-select-title">选择消息</h1>
            </div>
            <div class="placeholder"></div>
        </header>
        <main class="content">
            <div class="message-area" id="message-area"></div>
            <div class="typing-indicator" id="typing-indicator"></div>
        </main>
        <div class="chat-input-wrapper">
            <div id="sticker-bar">
                <button class="sticker-bar-btn" id="regenerate-btn" title="重回">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.65,6.35C16.2,4.9,14.21,4,12,4A8,8,0,0,0,4,12A8,8,0,0,0,12,20C15.73,20,18.84,17.45,19.73,14H17.65C16.83,16.33,14.61,18,12,18A6,6,0,0,1,6,12A6,6,0,0,1,12,6C13.66,6,15.14,6.69,16.22,7.78L13,11H20V4L17.65,6.35Z" />
                    </svg>
                </button>
                <button class="sticker-bar-btn" id="sticker-toggle-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
                    </svg>
                </button>
                <button class="sticker-bar-btn" id="photo-video-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"/>
                    </svg>
                </button>
                <button class="sticker-bar-btn" id="image-recognition-btn" title="图片">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21 19V5H3v14h18M5 7h14v10H5V7m3.5 1.5A1.5 1.5 0 1 1 7 10a1.5 1.5 0 0 1 1.5-1.5M19 17l-4.5-5.5L11 16l-2-2.5L5 17"/>
                    </svg>
                </button>
                <button class="sticker-bar-btn" id="voice-message-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                    </svg>
                </button>
                <button class="sticker-bar-btn" id="wallet-btn" title="转账">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4M20 18H4V8H20V18M16 12.5A1.5 1.5 0 1 0 16 15.5A1.5 1.5 0 0 0 16 12.5Z"/>
                    </svg>
                </button>
                <button class="sticker-bar-btn" id="gift-btn" title="礼物">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7.16 14h8.53a2 2 0 0 0 1.93-1.5L19 6H6.21L5.27 4H2v2h2l3.6 7.59L6.25 17H19v-2H7.65l-.49-1z"/>
                        <path d="M7 18a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm10 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/>
                    </svg>
                </button>
                <!-- NEW: Time Skip Button -->
                <button class="sticker-bar-btn" id="time-skip-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M4 5v14l7-7-7-7zm9 0v14l7-7-7-7z"></path>
                    </svg>
                </button>
                <button class="sticker-bar-btn" id="placeholder-plus-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                </button>
            </div>
            <div id="reply-preview-bar">
                <div class="reply-preview-content">
                    <span class="reply-preview-name"></span>
                    <p class="reply-preview-text"></p>
                </div>
                <button id="cancel-reply-btn">×</button>
            </div>
            <div class="message-input-area" id="message-input-default">
                <input type="text" id="message-input" placeholder="输入消息...">
                <button id="send-message-btn" class="icon-btn send-btn">➤</button>
                <button id="get-reply-btn" class="icon-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M12,2A10,10 0 1,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 1,1 20,12A8,8 0 0,1 12,20M16.24,7.76C15.07,6.58 13.53,6 12,6V12L7.76,16.24C10.1,18.58 13.9,18.58 16.24,16.24C18.58,13.9 18.58,10.1 16.24,7.76Z"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <div id="music-screen" class="screen"></div>

        
        <div id="multi-select-bar"><span id="select-count">已选择 0 项</span>
            <button class="btn btn-danger" id="delete-selected-btn" style="width: auto; padding: 8px 16px;">删除已选
            </button>
        </div>
        <div id="sticker-modal">
            <div class="header">
                <div class="header-left">
                    <span class="title">我的表情</span>
                </div>
                <div class="header-right">
                    <button class="panel-btn" id="sticker-category-manage-btn">分类</button>
                    <button class="panel-btn" id="manage-stickers-btn">管理</button>
                    <button class="panel-btn" id="batch-add-sticker-btn">批量</button>
                    <button class="panel-btn" id="add-new-sticker-btn">上传</button>
                </div>
            </div>
            <div id="sticker-category-tabs"></div>
            <div id="sticker-search-container">
                <input type="search" id="sticker-search-input" placeholder="搜索表情名称...">
            </div>
            <div class="sticker-grid" id="sticker-grid-container"></div>
            <div id="sticker-manage-bar">
                <label>
                    <input type="checkbox" id="sticker-select-all-checkbox">
                    全选
                </label>
                <button class="btn btn-danger" id="delete-selected-stickers-btn">删除 (0)</button>
            </div>
        </div>
        <!-- NEW: Chat Expansion Panel -->
        <div id="chat-expansion-panel">
            <div class="sticker-grid" id="chat-expansion-grid">
                <!-- Items will be populated by JS -->
            </div>
        </div>
    </div>
  
    <div id="world-book-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="home-screen">‹</button>
            <div class="title-container">
                <h1 class="title">世界书</h1>
            </div>
            <div class="action-btn-group">
                <button class="action-btn" id="add-world-book-btn">+</button>
                <button class="action-btn" id="cancel-wb-multi-select-btn" style="display: none; font-size: 16px;">取消</button>
            </div>
        </header>
        <main class="content">
            <ul class="list-container" id="world-book-list-container"></ul>
            <div class="placeholder-text" id="no-world-books-placeholder" style="display: none;">
                <p>你的世界一片混沌...</p>
                <p>点击右上角的“+”创造第一个设定吧！</p>
            </div>
        </main>
        <div id="world-book-multi-select-bar" style="display: none;">
            <span id="world-book-select-count">已选择 0 项</span>
            <button class="btn btn-danger" id="delete-selected-world-books-btn" style="width: auto; padding: 8px 16px;">删除已选</button>
        </div>
    </div>
    <div id="edit-world-book-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="world-book-screen">‹</button>
            <div class="title-container">
                <h1 class="title" id="edit-world-book-title">创建/编辑条目</h1>
            </div>
            <div class="placeholder"></div>
        </header>
        <main class="content">
            <form id="edit-world-book-form">
                <input type="hidden" id="world-book-id">
                <div class="form-group">
                    <label for="world-book-name">条目名称</label>
                    <input type="text" id="world-book-name" placeholder="例如：世界观背景、魔法体系" required>
                </div>
                <div class="form-group">
                    <label for="world-book-category">条目分类</label>
                    <input type="text" id="world-book-category" placeholder="例如：人物、地点、组织（可选）">
                </div>
                <div class="form-group">
                    <label for="world-book-content">条目内容</label>
                    <textarea id="world-book-content" rows="8" placeholder="详细描述此项设定..." required></textarea>
                </div>
                <div class="form-group">
                    <label>注入位置</label>
                    <div class="form-group radio-group">
                        <label><input type="radio" name="world-book-position" value="before" checked> 前</label>
                        <label><input type="radio" name="world-book-position" value="after"> 后</label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">保存条目</button>
            </form>
        </main>
    </div>
    <div id="api-settings-screen" class="screen"></div>
    <div id="wallpaper-screen" class="screen"></div>
    <div id="font-settings-screen" class="screen"></div>
    <div id="customize-screen" class="screen"></div>
    <div id="tutorial-screen" class="screen"></div>
    <div id="toast-notification" class="toast">
        <img class="toast-avatar" src="" alt="avatar">
        <div class="toast-content">
            <div class="toast-name"></div>
            <div class="toast-message"></div>
        </div>
    </div>
    <input type="file" id="image-upload-input" accept="image/*" style="display:none;">
    <!-- Message Edit Modal -->
    <div id="message-edit-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>编辑消息</h3>
            <form id="message-edit-form">
                <div class="form-group">
                    <textarea id="message-edit-textarea" rows="6" required></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">保存</button>
                    <button type="button" id="cancel-edit-modal-btn" class="btn btn-neutral" style="flex: 1;">取消</button>
                </div>
            </form>
        </div>
    </div>

    <div id="add-char-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>创建新角色</h3>
            <form id="add-char-form">
                <div class="form-group">
                    <label for="char-real-name">角色姓名</label><input type="text" id="char-real-name"
                                                                       placeholder="角色的真实姓名" required>
                </div>
                <div class="form-group">
                    <label for="char-remark-name">角色备注 (昵称)</label><input type="text" id="char-remark-name"
                                                                                placeholder="你对Ta的称呼" required>
                </div>
                <div class="form-group">
                    <label for="my-name-for-char">我的姓名</label><input type="text" id="my-name-for-char"
                                                                         placeholder="你希望Ta如何称呼你" required>
                </div>
                <button type="submit" class="btn btn-primary">创建</button>
            </form>
        </div>
    </div>
    <div id="add-sticker-modal" class="modal-overlay">
        <div class="modal-window">
            <h3 id="add-sticker-modal-title">添加新表情</h3>
            <form id="add-sticker-form"><input type="hidden" id="sticker-edit-id">
                <div id="sticker-preview"><span>预览</span></div>
                <div class="form-group"><label for="sticker-name">表情名称</label><input type="text" id="sticker-name"
                                                                                         placeholder="如：开心" required>
                </div>
                <div class="form-group">
                    <label for="sticker-category-select">选择分类</label>
                    <select id="sticker-category-select" class="form-group"></select>
                </div>
                <div class="form-group"><label for="sticker-url-input">表情URL</label><input type="url"
                                                                                             id="sticker-url-input"
                                                                                             placeholder="粘贴图片URL">
                </div>
                <div class="or-divider">或</div><input type="file"
                                                                                             id="sticker-file-upload"
                                                                                             accept="image/*"
                                                                                             style="display:none;"><label
                        for="sticker-file-upload" class="btn btn-secondary" style="width:100%; margin-bottom: 20px;">从本地上传</label>
                <button type="submit" class="btn btn-primary">保存</button>
            </form>
        </div>
    </div>
    <div id="sticker-actionsheet" class="action-sheet-overlay">
        <div class="action-sheet">
            <button class="action-sheet-button" id="edit-sticker-btn">编辑</button>
            <button class="action-sheet-button danger" id="delete-sticker-btn">删除</button>
        </div>
    </div>
    <!-- Batch Add Sticker Modal -->
    <div id="batch-add-sticker-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>批量导入表情</h3>
            <form id="batch-add-sticker-form">
                <div class="form-group">
                    <label for="sticker-urls-textarea">数据格式：名称:URL (英文冒号，每行一个)</label>
                    <textarea id="sticker-urls-textarea" rows="8" placeholder="例如：&#10;开心:https://example.com/happy.gif&#10;哭泣:https://example.com/cry.png"></textarea>
                </div>
                <div class="form-group">
                    <label for="batch-sticker-category-select">选择分类</label>
                    <select id="batch-sticker-category-select" class="form-group"></select>
                </div>
                <button type="submit" class="btn btn-primary">开始导入</button>
            </form>
        </div>
    </div>
    <div id="send-voice-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>发送语音消息</h3>
            <form id="send-voice-form">
                <div class="form-group">
                    <label for="voice-text-input">输入语音文字</label>
                    <textarea id="voice-text-input" placeholder="在这里输入你想说的话..." required rows="4"></textarea>
                </div>
                <div class="form-group" style="text-align:center; color:#888; font-size: 14px;">
                    预计时长: <span id="voice-duration-preview">0"</span>
                </div>
                <button type="submit" class="btn btn-primary">发送</button>
            </form>
        </div>
    </div>
    <div id="send-pv-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>分享照片/视频</h3>
            <form id="send-pv-form">
                <div class="form-group">
                    <label for="pv-text-input">输入描述</label>
                    <textarea id="pv-text-input" placeholder="在这里描述你的照片或视频内容..." required
                              rows="4"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">发送</button>
            </form>
        </div>
    </div>
    <div id="send-transfer-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>转账</h3>
            <form id="send-transfer-form">
                <div class="form-group">
                    <label for="transfer-amount-input">金额 (元)</label>
                    <input type="number" id="transfer-amount-input" placeholder="0.00" required step="0.01" min="0.01">
                </div>
                <div class="form-group">
                    <label for="transfer-remark-input">备注</label>
                    <input type="text" id="transfer-remark-input" placeholder="（选填）">
                </div>
                <button type="submit" class="btn btn-primary">发送</button>
            </form>
        </div>
    </div>
    <div id="send-gift-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>送出礼物</h3>
            <form id="send-gift-form">
                <div class="form-group">
                    <label for="gift-description-input">礼物描述</label>
                    <textarea id="gift-description-input" placeholder="告诉Ta你送了什么特别的东西..." required
                              rows="4"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">发送</button>
            </form>
        </div>
    </div>
    <!-- NEW: Time Skip Modal -->
    <div id="time-skip-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>记录今天发生的事</h3>
            <form id="time-skip-form">
                <div class="form-group">
                    <label for="time-skip-input">事件描述 (该消息AI可见，会作为上下文)</label>
                    <textarea id="time-skip-input" placeholder="例如：我们一起去山顶看了日落，然后吃了烧烤。" required
                              rows="4"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">发送</button>
            </form>
        </div>
    </div>
    <!-- NEW: Group Recipient Selection Modal -->
    <div id="group-recipient-selection-modal" class="modal-overlay">
        <div class="modal-window">
            <h3 id="group-recipient-selection-title">选择收件人</h3>
            <ul id="group-recipient-selection-list"></ul>
            <button class="btn btn-primary" id="confirm-group-recipient-btn" style="margin-top: 20px;">确认</button>
        </div>
    </div>
    <div id="receive-transfer-actionsheet" class="action-sheet-overlay">
        <div class="action-sheet">
            <button class="action-sheet-button" id="accept-transfer-btn">接收</button>
            <button class="action-sheet-button danger" id="return-transfer-btn">退回</button>
        </div>
    </div>
    <!-- Private Chat Settings -->
    <div id="chat-settings-sidebar" class="settings-sidebar">
        <div class="header">聊天设置</div>
        <div class="content">
            <form id="chat-settings-form">
                <div class="avatar-setting"><img src="" alt="角色头像" id="setting-char-avatar-preview"
                                                 class="avatar-preview"><input type="file"
                                                                               id="setting-char-avatar-upload"
                                                                               accept="image/*"
                                                                               style="display:none;"><label
                        for="setting-char-avatar-upload" class="btn btn-primary"
                        style="flex-grow:1;">更换角色头像</label></div>
                <div class="form-group"><label for="setting-char-remark">角色备注 (昵称)</label><input type="text"
                                                                                                       id="setting-char-remark">
                </div>
                <div class="form-group"><label for="setting-char-persona">角色人设</label><textarea
                        id="setting-char-persona" placeholder="详细描述角色的性格、背景、说话风格等。"></textarea></div>
                <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
                <div class="avatar-setting"><img src="" alt="我的头像" id="setting-my-avatar-preview"
                                                 class="avatar-preview"><input type="file" id="setting-my-avatar-upload"
                                                                               accept="image/*"
                                                                               style="display:none;"><label
                        for="setting-my-avatar-upload" class="btn btn-secondary"
                        style="flex-grow:1;">更换我的头像</label></div>
                <div class="form-group"><label for="setting-my-name">我的姓名</label><input type="text"
                                                                                            id="setting-my-name"></div>
                <div class="form-group"><label for="setting-my-persona">我的人设</label><textarea
                        id="setting-my-persona" placeholder="描述你希望在对话中扮演的形象。"></textarea></div>
               <div class="panel panel-sm" style="padding:12px;border-radius:10px;border:1px solid var(--border-color,#e8e8ef);background:var(--panel-bg,#fff);box-shadow:var(--panel-shadow,0 4px 12px rgba(20,20,30,0.04));margin:10px 0;"><div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;"><label for="mypersona-preset-select" style="width:88px;color:var(--muted,#667);font-size:13px;">人设</label><select id="mypersona-preset-select" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid var(--input-border,#e6e6ea);background:var(--input-bg,#fff);font-size:14px;"><option value="">— 选择预设 —</option></select><button type="button" id="mypersona-apply-btn" class="btn btn-primary" style="margin-left:8px;padding:7px 10px;border-radius:8px;">应用</button></div><div style="display:flex;gap:8px;align-items:center;margin-bottom:6px;"><label style="width:88px;color:var(--muted,#667);font-size:13px;">外观操作</label><button type="button" id="mypersona-save-btn" class="btn" style="padding:7px 10px;border-radius:8px;">另存为</button><button type="button" id="mypersona-manage-btn" class="btn" style="padding:7px 10px;border-radius:8px;">管理</button></div></div>
                <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
                <div class="form-group">
                    <button type="button" class="btn btn-secondary" id="link-world-book-btn">关联世界书</button>
                </div>
                <div class="form-group"><label for="setting-theme-color">主题颜色 (对方/我方)</label><select
                        id="setting-theme-color"></select></div>

                <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <label for="setting-use-custom-css" style="margin-bottom:0;">自定义气泡样式</label>
                        <input type="checkbox" id="setting-use-custom-css" style="width: auto;">
                    </div>
                    <div id="private-bubble-css-preview" class="bubble-css-preview"
                         style="background: #fff; border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 10px;">
                    </div>
                    <textarea id="setting-custom-bubble-css" rows="6"
                              placeholder="在此输入CSS代码...&#10;例如：&#10;.message-bubble.sent { background-color: #A5D6A7; }&#10;.message-bubble.received { background-color: #E1E1E1; }"
                              disabled></textarea>
                    <button type="button" class="btn btn-neutral" id="reset-custom-bubble-css-btn"
                            style="margin-top: 10px; width: auto; padding: 5px 15px; font-size: 14px;">恢复默认
                    </button>
                </div>
               <div class="panel panel-sm" style="padding:12px;border-radius:10px;border:1px solid var(--border-color,#e8e8ef);background:var(--panel-bg,#fff);box-shadow:var(--panel-shadow,0 4px 12px rgba(20,20,30,0.04));margin:10px 0;"><div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;"><label for="bubble-preset-select" style="width:88px;color:var(--muted,#667);font-size:13px;">气泡</label><select id="bubble-preset-select" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid var(--input-border,#e6e6ea);background:var(--input-bg,#fff);font-size:14px;"><option value="">— 选择预设 —</option></select><button type="button" id="apply-preset-btn" class="btn btn-primary" style="margin-left:8px;padding:7px 10px;border-radius:8px;">应用</button></div><div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;"><label style="width:88px;color:var(--muted,#667);font-size:13px;">外观操作</label><button type="button" id="save-preset-btn" class="btn" style="padding:7px 10px;border-radius:8px;">另存为</button><button type="button" id="manage-presets-btn" class="btn" style="padding:7px 10px;border-radius:8px;">管理</button></div></div>
                <div class="form-group"><label for="setting-max-memory">最大记忆轮数</label><input type="number"
                                                                                                   id="setting-max-memory"
                                                                                                   value="10" min="1">
                </div>
                <div class="form-group"><label for="setting-chat-bg-upload" class="btn btn-primary">更换聊天背景</label><input
                        type="file" id="setting-chat-bg-upload" accept="image/*" style="display:none;"></div>
                <div class="form-group" id="nai-character-settings-group">
        <hr style="opacity: 0.2; margin: 20px 0;">
        <label style="font-weight: 600; color: var(--accent-color);">NAI出图设置</label>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            为当前角色配置专属的NovelAI出图提示词
        </p>

        <div style="margin-top: 15px;">
            <label style="font-weight: 500;">提示词来源</label>
            <div style="display: flex; gap: 15px; margin-top: 10px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="nai-prompt-source" value="system" checked>
                    <span>使用系统设置</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="nai-prompt-source" value="character">
                    <span>使用当前角色配置</span>
                </label>
            </div>
        </div>

        <button type="button" id="character-nai-prompts-btn" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">配置角色专属提示词</button> </div>

                <button type="submit" class="btn btn-primary">保存设置</button>
            </form>
            <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
            <button type="button" class="btn btn-danger" id="clear-chat-history-btn">清空聊天记录</button>
        </div>
    </div>
    <div id="world-book-selection-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>选择要关联的世界书</h3>
            <ul id="world-book-selection-list"></ul>
            <button class="btn btn-primary" id="save-world-book-selection-btn" style="margin-top: 20px;">确认</button>
        </div>
    </div>
    <!-- Global Pomodoro World Book Selection Modal -->
    <div id="global-pomodoro-world-book-selection-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>为全局专注设置关联世界书</h3>
            <ul id="global-pomodoro-world-book-selection-list" class="list-container" style="max-height: 40vh; overflow-y: auto; padding: 0; margin: 15px 0;">
                <!-- World book items will be rendered here -->
            </ul>
            <button class="btn btn-primary" id="save-global-pomodoro-world-book-selection-btn" style="margin-top: 20px;">确认</button>
        </div>
    </div>
    <!-- Group Chat Creation Modal -->
    <div id="create-group-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>创建群聊</h3>
            <form id="create-group-form">
                <div class="form-group">
                    <label>选择群成员</label>
                    <ul id="member-selection-list" class="member-selection-list"></ul>
                </div>
                <div class="form-group">
                    <label for="group-name-input">群聊名称</label>
                    <input type="text" id="group-name-input" placeholder="给你的群聊起个名字吧" required>
                </div>
                <button type="submit" class="btn btn-primary">创建群聊</button>
            </form>
        </div>
    </div>
    <!-- Group Chat Settings -->
    <div id="group-settings-sidebar" class="settings-sidebar">
        <div class="header">群聊设置</div>
        <div class="content">
            <form id="group-settings-form">
                <div class="group-avatar-setting">
                    <img src="" alt="群头像" id="setting-group-avatar-preview" class="group-avatar-preview">
                    <input type="file" id="setting-group-avatar-upload" accept="image/*" style="display:none;">
                    <label for="setting-group-avatar-upload" class="btn btn-primary"
                           style="flex-grow:1;">更换群头像</label>
                </div>
                <div class="form-group">
                    <label for="setting-group-name">群名 (AI也可见)</label>
                    <input type="text" id="setting-group-name">
                </div>
                <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
                <div class="avatar-setting">
                    <img src="" alt="我的头像" id="setting-group-my-avatar-preview" class="avatar-preview">
                    <input type="file" id="setting-group-my-avatar-upload" accept="image/*" style="display:none;">
                    <label for="setting-group-my-avatar-upload" class="btn btn-secondary"
                           style="flex-grow:1;">更换我的头像</label>
                </div>
                <div class="form-group">
                    <label for="setting-group-my-nickname">我的群昵称</label>
                    <input type="text" id="setting-group-my-nickname">
                </div>
                <div class="form-group">
                    <label for="setting-group-my-persona">我的人设</label>
                    <textarea id="setting-group-my-persona" placeholder="描述你希望在此群聊中扮演的形象。"></textarea>
                </div>
                <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
                <div class="form-group">
                    <label>群成员</label>
                    <div class="group-members-list" id="group-members-list-container"></div>
                </div>
                <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
                <div class="form-group">
                    <button type="button" class="btn btn-secondary" id="link-group-world-book-btn">关联世界书</button>
                </div>
                <div class="form-group"><label for="setting-group-theme-color">主题颜色 (对方/我方)</label><select
                        id="setting-group-theme-color"></select></div>

                <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <label for="setting-group-use-custom-css" style="margin-bottom:0;">自定义气泡样式</label>
                        <input type="checkbox" id="setting-group-use-custom-css" style="width: auto;">
                    </div>
                    <div id="group-bubble-css-preview" class="bubble-css-preview"
                         style="background: #fff; border: 1px solid #eee; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; flex-direction: column; gap: 10px;">
                    </div>
                    <textarea id="setting-group-custom-bubble-css" rows="6"
                              placeholder="在此输入CSS代码...&#10;例如：&#10;.message-bubble.sent { background-color: #A5D6A7; }&#10;.message-bubble.received { background-color: #E1E1E1; }"
                              disabled></textarea>
                    <button type="button" class="btn btn-neutral" id="reset-group-custom-bubble-css-btn"
                            style="margin-top: 10px; width: auto; padding: 5px 15px; font-size: 14px;">恢复默认
                    </button>
                </div>
                <div class="panel panel-sm" style="padding:12px;border-radius:10px;border:1px solid var(--border-color,#e8e8ef);background:var(--panel-bg,#fff);box-shadow:var(--panel-shadow,0 4px 12px rgba(20,20,30,0.04));margin:10px 0;"><div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;"><label for="group-bubble-preset-select" style="width:88px;color:var(--muted,#667);font-size:13px;">气泡预设</label><select id="group-bubble-preset-select" style="flex:1;padding:8px 10px;border-radius:8px;border:1px solid var(--input-border,#e6e6ea);background:var(--input-bg,#fff);font-size:14px;"><option value="">— 选择预设 —</option></select><button type="button" id="group-apply-preset-btn" class="btn btn-primary" style="margin-left:8px;padding:7px 10px;border-radius:8px;">应用</button></div><div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;"><label style="width:88px;color:var(--muted,#667);font-size:13px;">外观操作</label><button type="button" id="group-save-preset-btn" class="btn" style="padding:7px 10px;border-radius:8px;">另存为</button><button type="button" id="group-manage-presets-btn" class="btn" style="padding:7px 10px;border-radius:8px;">管理</button></div></div>
                <div class="form-group"><label for="setting-group-max-memory">最大记忆轮数</label><input type="number"
                                                                                                         id="setting-group-max-memory"
                                                                                                         value="10"
                                                                                                         min="1"></div>
                <div class="form-group"><label for="setting-group-chat-bg-upload"
                                               class="btn btn-primary">更换聊天背景</label><input type="file"
                                                                                                  id="setting-group-chat-bg-upload"
                                                                                                  accept="image/*"
                                                                                                  style="display:none;">
                </div>
                <div class="form-group" id="group-nai-settings-group">
        <hr style="opacity: 0.2; margin: 20px 0;">
        <label style="font-weight: 600; color: var(--accent-color);">NAI出图设置</label>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
            为当前群聊配置专属的NovelAI出图提示词 (对所有AI成员生效)
        </p>

        <div style="margin-top: 15px;">
            <label style="font-weight: 500;">提示词来源</label>
            <div style="display: flex; gap: 15px; margin-top: 10px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="group-nai-prompt-source" value="system" checked>
                    <span>使用系统设置</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="group-nai-prompt-source" value="character">
                    <span>使用当前群聊配置</span>
                </label>
            </div>
        </div>

        <button type="button" id="group-character-nai-prompts-btn" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">配置群聊专属提示词</button> </div>
                <button type="submit" class="btn btn-primary">保存设置</button>
            </form>
            <hr style="border:none; border-top:1px solid #eee; margin: 20px 0;">
            <button type="button" class="btn btn-danger" id="clear-group-chat-history-btn">清空聊天记录</button>
        </div>
    </div>
    <!-- Group Member Edit Modal -->
    <div id="edit-group-member-modal" class="modal-overlay">
        <div class="modal-window">
            <h3 id="edit-group-member-title">编辑群成员</h3>
            <form id="edit-group-member-form">
                <input type="hidden" id="editing-member-id">
                <div class="avatar-setting" style="justify-content: center;">
                    <img src="" alt="成员头像" id="edit-member-avatar-preview" class="avatar-preview"
                         style="cursor: pointer;">
                    <input type="file" id="edit-member-avatar-upload" accept="image/*" style="display:none;">
                </div>
                <div class="form-group">
                    <label for="edit-member-group-nickname">群昵称</label>
                    <input type="text" id="edit-member-group-nickname" required>
                </div>
                <div class="form-group">
                    <label for="edit-member-real-name">真名</label>
                    <input type="text" id="edit-member-real-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-member-persona">人设</label>
                    <textarea id="edit-member-persona" placeholder="详细描述角色的性格、背景等。"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">保存</button>
            </form>
        </div>
    </div>
    <!-- Add Member to Group Action Sheet -->
    <div id="add-member-actionsheet" class="action-sheet-overlay">
        <div class="action-sheet">
            <button class="action-sheet-button" id="invite-existing-member-btn">邀请现有角色</button>
            <button class="action-sheet-button" id="create-new-member-btn">创建新角色入群</button>
        </div>
    </div>
    <!-- Invite Existing Member Modal -->
    <div id="invite-member-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>邀请成员加入群聊</h3>
            <ul id="invite-member-selection-list"></ul>
            <button class="btn btn-primary" id="confirm-invite-btn" style="margin-top: 20px;">确认邀请</button>
        </div>
    </div>
    <!-- Create New Member for Group Modal -->
    <div id="create-member-for-group-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>创建新角色并加入群聊</h3>
            <form id="create-member-for-group-form">
                <div class="avatar-setting" style="justify-content: center;">
                    <img src="https://i.postimg.cc/Y96LPskq/o-o-2.jpg" alt="新成员头像"
                         id="create-group-member-avatar-preview" class="avatar-preview" style="cursor: pointer;">
                    <input type="file" id="create-group-member-avatar-upload" accept="image/*" style="display:none;">
                </div>
                <div class="form-group">
                    <label for="create-group-member-nickname">群昵称</label>
                    <input type="text" id="create-group-member-nickname" required>
                </div>
                <div class="form-group">
                    <label for="create-group-member-realname">真名</label>
                    <input type="text" id="create-group-member-realname" required>
                </div>
                <div class="form-group">
                    <label for="create-group-member-persona">人设</label>
                    <textarea id="create-group-member-persona" placeholder="详细描述角色的性格、背景等。"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">创建并加入</button>
            </form>
        </div>
    </div>
    <!-- Memory Journal Screen -->
    <div id="memory-journal-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="chat-room-screen">‹</button>
            <div class="title-container">
                <h1 class="title">回忆日记</h1>
            </div>
            <div class="action-btn-group">
                <button class="action-btn" id="bind-journal-worldbook-btn" title="绑定世界书">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h8v2H8v-2z"></path>
                    </svg>
                </button>
                <button class="action-btn" id="generate-new-journal-btn" title="生成新日记">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
                    </svg>
                </button>
            </div>
        </header>
        <main class="content">
            <ul class="list-container" id="journal-list-container">
                <!-- Journal cards will be rendered here -->
            </ul>
            <div class="placeholder-text" id="no-journals-placeholder" style="display: none;">
                <p>还没有日记哦~</p>
                <p>点击右上角的“+号”来创建第一篇吧！</p>
            </div>
        </main>
    </div>

    <!-- Memory Journal Detail Screen -->
    <div id="memory-journal-detail-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="memory-journal-screen">‹</button>
            <div class="title-container">
                <h1 class="title">日记详情</h1>
            </div>
            <button class="action-btn" id="edit-journal-detail-btn">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg>
            </button>
        </header>
        <main class="content" style="padding: 20px; font-family: 'Georgia', 'Times New Roman', serif;">
            <h2 id="journal-detail-title" style="margin-top: 0; font-size: 22px;"></h2>
            <p id="journal-detail-meta" style="font-size: 12px; color: #aaa; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px;"></p>
            <div id="journal-detail-content" style="line-height: 1.7; white-space: pre-wrap; font-size: 16px;"></div>
        </main>
    </div>

    <!-- Peek Steps App Screen -->
    <div id="peek-steps-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="peek-screen">‹</button>
            <div class="title-container">
                <h1 class="title">步数</h1>
            </div>
            <div class="placeholder"></div> <!-- To balance the header -->
        </header>
        <main class="content">
            <div class="steps-header">
                <img src="https://i.postimg.cc/Y96LPskq/o-o-2.jpg" alt="Char Avatar" class="steps-header-avatar" id="steps-char-avatar">
                <span class="steps-header-name" id="steps-char-name">Char</span>
            </div>

            <div class="steps-progress-container">
                <div class="steps-progress-circle" id="steps-progress-ring"></div>
                <div class="steps-progress-inner">
                    <div class="steps-count" id="steps-current-count">4321</div>
                    <div class="steps-label">/ 6000 步</div>
                </div>
            </div>

            <div class="steps-module">
                <h3 class="steps-module-title">最近活动轨迹</h3>
                <ul class="activity-track-list" id="activity-track-list">
                    <li class="activity-track-item">10:00 AM - 咖啡馆</li>
                    <li class="activity-track-item">01:30 PM - 市中心图书馆</li>
                    <li class="activity-track-item">06:00 PM - 河边公园</li>
                    <li class="activity-track-item">07:00 PM - 健身房</li>
                    <li class="activity-track-item">08:30 PM - 超市</li>
                    <li class="activity-track-item">09:00 PM - 回家</li>
                </ul>
            </div>
            <div class="steps-annotation" id="steps-annotation-content">
                “今天走了不少路，但感觉很充实。特别是下午在图书馆找到的那本书，感觉能看很久。”
            </div>
        </main>
    </div>

    <div id="peek-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="chat-room-screen">‹</button>
            <div class="title-container">
                <h1 class="title">Ta的手机</h1>
            </div>
            <button class="action-btn" id="peek-settings-btn"><img src="https://i.postimg.cc/nhwP4pQy/chan-73.png" alt="设置"></button>
        </header>
        <main class="content" style="padding: 50px 0; justify-content: flex-start; align-items: center;">
            <!-- Content rendered by renderPeekScreen() -->
        </main>
    </div>

   <div id="forum-screen" class="screen">
    <header class="app-header">
        <button class="back-btn" data-target="home-screen">←</button>
        <div class="title-container">
            <h1 class="title">论坛</h1>
        </div>

        <div class="action-btn-group"></div>
    </header>
    <main class="content" style="padding: 15px;">

        <div class="forum-search-bar">
            <button class="action-btn" id="forum-link-btn" title="绑定">
                <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                    <path d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h8v2H8v-2z"></path>
                </svg>
            </button>
            <input type="text" id="forum-search-input" placeholder="搜索关键词">
            <button class="action-btn" id="forum-refresh-btn" title="刷新">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></svg>
            </button>
        </div>

        <div id="forum-posts-container">
            <p class="placeholder-text" style="margin-top: 50px;">点击右上角刷新按钮来生成帖子...</p>
        </div>
    </main>
</div>



<div id="forum-post-detail-screen" class="screen">

</div>


<div id="storage-analysis-screen" class="screen">
    <header class="app-header">
        <button class="back-btn" data-target="home-screen">‹</button>
        <div class="title-container">
            <h1 class="title">存储分析</h1>
        </div>
        <div class="placeholder"></div>
    </header>
    <main class="content" style="flex-direction: column; justify-content: flex-start; padding: 20px; gap: 20px;">
        <div id="storage-chart-container" style="width: 100%; height: 300px; flex-shrink: 0;"></div>
        <div id="storage-total-size-container" style="text-align: center; padding: 10px 0; border-bottom: 1px solid #f0f0f0; margin-bottom: 10px;">
            <span style="font-size: 14px; color: #888;">总占用空间</span>
            <h2 id="storage-total-size" style="margin: 4px 0 0 0; font-size: 24px; color: #333; font-weight: 600;">---</h2>
        </div>
        <div id="storage-details-list" style="width: 100%; overflow-y: auto;"></div>
    </main>
</div>


<div id="peek-messages-screen" class="screen">

        <header class="app-header">
            <button class="back-btn" data-target="peek-screen">‹</button>
            <div class="title-container">
                <h1 class="title">Ta的消息</h1>
            </div>
            <button class="action-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></svg>
            </button>
        </header>
        <main class="content">
            <ul class="list-container" id="peek-chat-list-container">
                <!-- Simulated chat list will be rendered here -->
            </ul>
        </main>
    </div>

    <!-- Peek Conversation Screen -->
    <div id="peek-conversation-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="peek-messages-screen">‹</button>
            <div class="title-container">
                <h1 class="title" id="peek-conversation-title">...</h1>
            </div>
            <button class="action-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></svg>
            </button>
        </header>
        <main class="content">
            <div class="message-area" id="peek-message-area">
                <!-- Simulated messages will be rendered here -->
            </div>
        </main>
    </div>

    <!-- Peek Memos Screen -->
    <div id="peek-memos-screen" class="screen"></div>

    <!-- Peek Memo Detail Screen -->
    <div id="peek-memo-detail-screen" class="screen"></div>

    <!-- Peek Cart Screen -->
    <div id="peek-cart-screen" class="screen"></div>

    <!-- Peek Transfer Station Screen -->
    <div id="peek-transfer-station-screen" class="screen"></div>

    <!-- Peek Browser Screen -->
    <div id="peek-browser-screen" class="screen"></div>

    <!-- Peek Drafts Screen -->
    <div id="peek-drafts-screen" class="screen"></div>

    <div id="peek-album-screen" class="screen">
        <header class="app-header">
            <button class="back-btn" data-target="peek-screen">‹</button>
            <div class="title-container"><h1 class="title">相册</h1></div>
            <button class="action-btn" id="refresh-album-btn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></svg></button>
        </header>
        <main class="content">
            <div class="album-grid">
                <p class="placeholder-text">正在生成相册内容...</p>
            </div>
        </main>
    </div>
 
    <!-- Peek Unlock Screen (Social Media) -->
    <div id="peek-unlock-screen" class="screen">
        <!-- Content will be dynamically rendered by renderPeekUnlock() -->
    </div>
 
    <div id="peek-confirm-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>要偷看ta的手机吗？</h3>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="peek-confirm-yes" class="btn btn-primary" style="flex: 1;">是</button>
                <button id="peek-confirm-no" class="btn btn-neutral" style="flex: 1;">否</button>
            </div>
        </div>
    </div>
    <!-- New Peek Wallpaper Modal -->
    <div id="peek-wallpaper-modal" class="modal-overlay">
        <div class="modal-window" style="max-height: 80vh; overflow-y: auto;">
            <h3>“偷看”页面自定义</h3>
            <div class="collapsible-section open">
                <div class="collapsible-header">
                    <h4>页面壁纸</h4>
                    <span class="collapsible-arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <form id="peek-wallpaper-form">
                        <div class="form-group">
                            <label for="peek-wallpaper-url-input">壁纸URL</label>
                            <input type="url" id="peek-wallpaper-url-input" class="form-group" placeholder="粘贴图片URL">
                        </div>
                        <p style="text-align:center; color:#888; margin: -10px 0 15px;">或</p>
                        <input type="file" id="peek-wallpaper-upload" accept="image/*" style="display: none;">
                        <label for="peek-wallpaper-upload" class="btn btn-secondary">从本地上传</label>
                    </form>
                </div>
            </div>
            <div class="collapsible-section">
                <div class="collapsible-header">
                    <h4>应用图标</h4>
                    <span class="collapsible-arrow">▼</span>
                </div>
                <div class="collapsible-content" id="peek-app-icons-settings">
                    <!-- App icon settings will be rendered here by JS -->
                </div>
            </div>
             <div class="collapsible-section">
                <div class="collapsible-header">
                    <h4>微博(Unlock)小号</h4>
                    <span class="collapsible-arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <div class="form-group">
                        <label for="peek-unlock-avatar-url">头像URL</label>
                        <input type="url" id="peek-unlock-avatar-url" class="form-group" placeholder="粘贴图片URL">
                    </div>
                </div>
            </div>
            <button id="save-peek-settings-btn" class="btn btn-primary" style="margin-top: 20px;">保存所有更改</button>
        </div>
    </div>
<div id="pomodoro-screen" class="screen">
    <header class="app-header">
        <button class="back-btn" data-target="home-screen">‹</button>
        <div class="title-container">
            <h1 class="title">专注任务</h1>
        </div>
        <div class="action-btn-group">
            <button class="action-btn" id="pomodoro-settings-btn" title="设置">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.2,5.77C8.61,6.01,8.08,6.33,7.58,6.71L5.19,5.75C4.97,5.68,4.72,5.75,4.6,5.97L2.68,9.29 c-0.11,0.2-0.06,0.47,0.12,0.61l2.03,1.58C4.78,11.66,4.76,11.97,4.76,12.3c0,0.32,0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.36-2.54c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0.01,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
            </button>
            <button class="action-btn" id="pomodoro-create-task-btn" title="创建任务">+</button>
        </div>
    </header>
    <main class="content">
        <div class="task-list-container" id="pomodoro-task-list">
            <!-- Task cards will be rendered here by JS -->
        </div>
        <p class="placeholder-text" id="pomodoro-no-tasks-placeholder">还没有专注任务，点击右上角“+”创建一个吧。</p>
    </main>
</div>
<!-- Pomodoro Focus Screen -->
<div id="pomodoro-focus-screen" class="screen">
    <header class="app-header">
        <button class="back-btn" data-target="pomodoro-screen">‹</button>
        <div class="title-container">
            <h1 class="title">专注中</h1>
        </div>
        <div class="action-btn-group">
            <button class="action-btn" id="pomodoro-focus-settings-btn" title="设置">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22" height="22"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.44,0.17-0.48,0.41L9.2,5.77C8.61,6.01,8.08,6.33,7.58,6.71L5.19,5.75C4.97,5.68,4.72,5.75,4.6,5.97L2.68,9.29 c-0.11,0.2-0.06,0.47,0.12,0.61l2.03,1.58C4.78,11.66,4.76,11.97,4.76,12.3c0,0.32,0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.48-0.41l0.36-2.54c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0.01,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
            </button>
        </div>
    </header>
    <main class="content">
        <div class="focus-timer-container">
            <h2 class="focus-task-title">阅读一章《JavaScript高级程序设计》</h2>
            <div class="focus-timer-display">24:32</div>
            <div class="focus-timer-mode">倒计时</div>
            <div class="focus-total-time" id="pomodoro-total-focused-time">已专注 0 分钟</div>
        </div>

        <div class="focus-footer">
            <div class="focus-message-bubble">
                <p>保持专注，你做得很好！</p>
            </div>
            <div class="focus-bottom-controls">
                <div class="focus-controls-group">
                    <button class="control-btn" id="pomodoro-start-btn" title="开始">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    </button>
                    <button class="control-btn" id="pomodoro-pause-btn" title="暂停" style="display: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                    </button>
                </div>
                <img src="https://i.postimg.cc/Y96LPskq/o-o-2.jpg" class="focus-avatar" alt="avatar">
                <button class="control-btn" id="pomodoro-giveup-btn" title="放弃">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
        </div>
    </main>
</div>

<!-- Pomodoro Settings Sidebar -->
<div id="pomodoro-settings-sidebar" class="settings-sidebar">
    <div class="header">专注设置</div>
    <div class="content">
        <form id="pomodoro-settings-form">
            <div class="form-group">
                <label for="pomodoro-char-select">绑定陪伴角色</label>
                <select id="pomodoro-char-select" class="form-group"></select>
            </div>
            <div class="form-group">
                <label for="pomodoro-user-persona-select">选择你的设定</label>
                <select id="pomodoro-user-persona-select" class="form-group"></select>
            </div>
            <hr>
            <div class="form-group">
                <label for="pomodoro-encouragement-minutes">鼓励机制 (分钟)</label>
                <input type="number" id="pomodoro-encouragement-minutes" class="form-group" placeholder="专注多少分钟后收到鼓励" min="1">
            </div>
            <div class="form-group">
                <label for="pomodoro-poke-limit">“戳一戳”次数上限</label>
                <input type="number" id="pomodoro-poke-limit" class="form-group" placeholder="每次专注允许戳几次" min="0">
            </div>
            <hr>
            <div class="form-group">
                <label for="pomodoro-focus-bg-url">专注界面背景 URL</label>
                <input type="url" id="pomodoro-focus-bg-url" class="form-group" placeholder="粘贴图片URL">
            </div>
            <div class="form-group">
                <label for="pomodoro-focus-bg-upload" class="btn btn-secondary">或从本地上传</label>
                <input type="file" id="pomodoro-focus-bg-upload" accept="image/*" style="display:none;">
            </div>
            <hr>
            <div class="form-group">
                <label for="pomodoro-task-card-bg-url">任务卡片背景 URL</label>
                <input type="url" id="pomodoro-task-card-bg-url" class="form-group" placeholder="粘贴图片URL">
            </div>
            <div class="form-group">
                <label for="pomodoro-task-card-bg-upload" class="btn btn-secondary">或从本地上传</label>
                <input type="file" id="pomodoro-task-card-bg-upload" accept="image/*" style="display:none;">
            </div>
            <button type="submit" class="btn btn-primary" style="margin-top: 20px;">保存设置</button>
        </form>
    </div>
</div>

<!-- Pomodoro Global Settings Sidebar -->
<div id="pomodoro-global-settings-sidebar" class="settings-sidebar">
    <div class="header">全局专注设置</div>
    <div class="content">
        <form id="pomodoro-global-settings-form">
            <div class="form-group">
                <button type="button" class="btn btn-secondary" id="link-global-pomodoro-world-book-btn">关联世界书</button>
            </div>
            <p style="font-size: 12px; color: #888; margin-top: 15px;">
                这里关联的世界书将作为全局上下文，作用于所有番茄钟任务的AI互动。
            </p>
        </form>
    </div>
</div>

<!-- Pomodoro Certificate Modal -->
<div id="pomodoro-certificate-modal" class="modal-overlay">
    <div class="modal-window" style="text-align: center;">
        <h3>专注完成！</h3>
        <div id="pomodoro-certificate-content" style="border: 2px dashed var(--primary-color); padding: 20px; margin: 15px 0; border-radius: 10px; background: #fff8fa;">
            <p><strong>任务名称:</strong> <span id="cert-task-name"></span></p>
            <p><strong>专注时长:</strong> <span id="cert-duration"></span></p>
            <p><strong>“戳一戳”次数:</strong> <span id="cert-poke-count"></span></p>
        </div>
        <p>做的很棒！要不要把这次的专注成果分享一下？</p>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="forward-certificate-btn" class="btn btn-primary" style="flex: 1;">转发到聊天框</button>
            <button id="close-certificate-btn" class="btn btn-neutral" style="flex: 1;">关闭</button>
        </div>
    </div>
</div>

<!-- Pomodoro Record Detail Modal -->

<!-- Pomodoro Create Task Modal -->
<div id="pomodoro-create-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>创建专注任务</h3>
        <form id="pomodoro-create-form">
            <div class="form-group">
                <label for="pomodoro-task-name">任务名称</label>
                <input type="text" id="pomodoro-task-name" class="form-group" placeholder="例如：阅读一章《JavaScript高级程序设计》" required>
            </div>
            <div class="form-group">
                <label>计时模式</label>
                <div class="radio-group-pills">
                    <input type="radio" id="mode-countdown" name="pomodoro-mode" value="countdown" checked>
                    <label for="mode-countdown">倒计时</label>
                    <input type="radio" id="mode-stopwatch" name="pomodoro-mode" value="stopwatch">
                    <label for="mode-stopwatch">正计时</label>
                </div>
            </div>
            <div id="pomodoro-duration-options" class="visible">
                <button type="button" class="duration-pill active" data-duration="30">30分钟</button>
                <button type="button" class="duration-pill" data-duration="45">45分钟</button>
                <button type="button" class="duration-pill" data-duration="60">60分钟</button>
                <button type="button" class="duration-pill" data-duration="custom">自定义</button>
                <input type="number" id="pomodoro-custom-duration-input" class="form-group" placeholder="输入分钟数">
            </div>
            <button type="submit" class="btn btn-primary" style="margin-top: 20px;">创建任务</button>
        </form>
    </div>
</div>
    <div id="peek-photo-modal" class="modal-overlay">
        <div class="modal-window">
            <div id="peek-photo-image-container">
                <span class="placeholder-icon">🖼️</span>
            </div>
            <div id="peek-photo-description"></div>
        </div>
    </div>
</div>
 
<!-- Polaroid Customization Modal -->
<div id="heart-photo-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>自定义拍立得</h3>
        <form id="heart-photo-form">
            <div id="heart-photo-preview" style="width: 150px; height: 150px; border: 2px dashed #ddd; border-radius: 10px; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: #aaa; background-color: #f9f9f9; background-size: cover; background-position: center;">
                <span>预览</span>
            </div>
            <div class="form-group">
                <label for="heart-photo-url-input">图片URL</label>
                <input type="url" id="heart-photo-url-input" class="form-group" placeholder="粘贴图片URL">
            </div>
            <p style="text-align:center; color:#888; margin: -10px 0 15px;">或</p>
            <input type="file" id="heart-photo-file-upload" accept="image/*" style="display:none;">
            <label for="heart-photo-file-upload" class="btn btn-secondary" style="width:100%; margin-bottom: 20px;">从本地上传</label>
            <button type="submit" class="btn btn-primary">保存</button>
        </form>
    </div>
</div>
    <div id="forum-binding-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>绑定上下文</h3>
            <div class="forum-binding-tabs">
                <button class="tab-btn active" data-target="binding-content-worldbook">世界书</button>
                <button class="tab-btn" data-target="binding-content-char">char</button>
                <button class="tab-btn" data-target="binding-content-user">user</button>
            </div>
            <div id="forum-binding-content-wrapper">
                <div id="binding-content-worldbook" class="forum-binding-content active">
                    <ul id="forum-worldbook-list" class="binding-list"></ul>
                </div>
                <div id="binding-content-char" class="forum-binding-content">
                    <ul id="forum-char-list" class="binding-list"></ul>
                </div>
                <div id="binding-content-user" class="forum-binding-content">
                    <ul id="forum-user-list" class="binding-list"></ul>
                </div>
            </div>
            <button id="confirm-forum-binding-btn" class="btn btn-primary" style="margin-top: 20px;">确认绑定</button>
        </div>
    </div>


<!-- Generate Journal Modal -->
<div id="generate-journal-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>指定总结范围</h3>
        <form id="generate-journal-form">
            <div id="journal-range-info" style="font-size: 12px; color: #888; text-align: center; margin-bottom: 15px;"></div>
            <div class="form-group">
                <label for="journal-range-start">起始消息 (序号)</label>
                <input type="number" id="journal-range-start" placeholder="例如：1" required>
            </div>
            <div class="form-group">
                <label for="journal-range-end">结束消息 (序号)</label>
                <input type="number" id="journal-range-end" placeholder="例如：100" required>
            </div>
            <button type="submit" class="btn btn-primary">生成</button>
        </form>
    </div>
</div>

<!-- Journal World Book Selection Modal -->
<div id="journal-worldbook-selection-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>为日记绑定世界书</h3>
        <ul id="journal-worldbook-selection-list" class="list-container" style="max-height: 40vh; overflow-y: auto; padding: 0; margin: 15px 0;">
            <!-- World book items will be rendered here -->
        </ul>
        <button class="btn btn-primary" id="save-journal-worldbook-selection-btn" style="margin-top: 20px;">确认</button>
    </div>
</div>

<!-- NEW: Delete History Chunk Modals -->
<div id="delete-chunk-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>删除指定范围记录</h3>
        <form id="delete-chunk-form">
            <div id="delete-chunk-range-info" style="font-size: 12px; color: #888; text-align: center; margin-bottom: 15px;"></div>
            <div class="form-group">
                <label for="delete-range-start">起始消息 (序号)</label>
                <input type="number" id="delete-range-start" placeholder="例如：1" required>
            </div>
            <div class="form-group">
                <label for="delete-range-end">结束消息 (序号)</label>
                <input type="number" id="delete-range-end" placeholder="例如：100" required>
            </div>
            <button type="submit" class="btn btn-primary">下一步</button>
        </form>
    </div>
</div>

<div id="share-post-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>是否将分享给他人？</h3>
        <div style="margin: 20px 0;">
            <details>
                <summary style="font-weight: 500; cursor: pointer; color: var(--primary-color);">选择分享对象</summary>
                <ul id="share-char-list" class="binding-list" style="margin-top: 10px; max-height: 40vh; overflow-y: auto;">

                </ul>
            </details>
        </div>
        <button id="confirm-share-btn" class="btn btn-primary" style="margin-top: 15px;">确认发送</button>
    </div>
</div>


<div id="delete-chunk-confirm-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>确认删除</h3>
        <p>将永久删除以下范围的消息，此操作不可撤销！</p>
        <div id="delete-chunk-preview" style="max-height: 200px; overflow-y: auto; background: #f5f5f5; border-radius: 8px; padding: 10px; margin: 15px 0; font-size: 12px; line-height: 1.5;">
            <!-- Preview will be inserted here -->
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="confirm-delete-chunk-btn" class="btn btn-danger" style="flex: 1;">永久删除</button>
            <button id="cancel-delete-chunk-btn" class="btn btn-neutral" style="flex: 1;">取消</button>
        </div>
    </div>
</div>

<div id="bubble-presets-modal" class="modal-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;"><div class="modal-window" style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);"><h3 style="margin:0 0 10px 0;font-size:16px;">管理气泡预设</h3><div id="bubble-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div><div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="close-presets-modal" class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">关闭</button></div></div></div>
<div id="mypersona-presets-modal" class="modal-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;"><div class="modal-window" style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);"><h3 style="margin:0 0 10px 0;font-size:16px;">管理我的人设预设</h3><div id="mypersona-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div><div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="mypersona-close-modal" class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">关闭</button></div></div></div>
<div id="global-css-presets-modal" class="modal-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);justify-content:center;align-items:center;z-index:9999;"><div class="modal-window" style="max-width:520px;background:var(--panel-bg,#fff);padding:14px;border-radius:10px;box-shadow:0 12px 36px rgba(10,10,20,0.12);"><h3 style="margin:0 0 10px 0;font-size:16px;">管理全局CSS预设</h3><div id="global-css-presets-list" style="max-height:340px; overflow:auto; margin-bottom:12px;"></div><div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="global-css-close-modal" class="btn btn-primary" style="padding:8px 12px;border-radius:8px;">关闭</button></div></div></div>
<input type="file" id="import-data-input" accept=".ee" style="display: none;">
<div id="storage-screen" class="screen"></div>
<input type="file" id="character-card-input" accept="image/png,application/json" style="display: none;">
<!-- INS Widget Avatar Modal -->
<div id="ins-widget-avatar-modal" class="modal-overlay">
    <div class="modal-window">
        <h3>更换头像</h3>
        <form id="ins-widget-avatar-form">
            <input type="hidden" id="ins-widget-avatar-target">
            <div id="ins-widget-avatar-preview" style="width: 100px; height: 100px; border: 2px dashed #ddd; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: #aaa; background-color: #f9f9f9; background-size: cover; background-position: center;">
                <span>预览</span>
            </div>
            <div class="form-group">
                <label for="ins-widget-avatar-url-input">头像URL</label>
                <input type="url" id="ins-widget-avatar-url-input" class="form-group" placeholder="粘贴图片URL">
            </div>
            <p style="text-align:center; color:#888; margin: -10px 0 15px;">或</p>
            <input type="file" id="ins-widget-avatar-file-upload" accept="image/*" style="display:none;">
            <label for="ins-widget-avatar-file-upload" class="btn btn-secondary" style="width:100%; margin-bottom: 20px;">从本地上传</label>
            <button type="submit" class="btn btn-primary">保存</button>
        </form>
    </div>
</div>
    <!-- Update Log Modal -->
    <div id="update-log-modal" class="modal-overlay">
        <div class="modal-window">
            <h3>发现新版本！</h3>
            <div id="update-log-modal-content">
                <!-- Update content will be injected here -->
            </div>
            <button id="close-update-log-modal" class="btn btn-primary" style="margin-top: 15px;">我知道了</button>
        </div>
    </div>
        /* --- Update Log Modal Styles --- */
        #update-log-modal .modal-window {
            max-width: 380px;
            text-align: left;
        }

        #update-log-modal-content {
            max-height: 60vh;
            overflow-y: auto;
            padding: 15px 15px;
            margin: 15px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            background-color: #fcfcfc;
            border-radius: 8px;
        }

        #update-log-modal-content h4 {
            font-size: 16px;
            color: var(--primary-color);
            margin-top: 10px;
            margin-bottom: 8px;
        }

        #update-log-modal-content ul {
            list-style-type: none;
            padding-left: 5px;
            margin: 0;
        }

        #update-log-modal-content li {
            margin-bottom: 8px;
            line-height: 1.6;
            font-size: 14px;
            color: #555;
            position: relative;
            padding-left: 20px;
        }

        #update-log-modal-content li::before {
            content: '✨';
            position: absolute;
            left: 0;
            top: 2px;
            color: var(--accent-color);
        }

        /* --- NovelAI 相关样式 (v2 - UI对齐修复) --- */

        /* API 设置页面的开关样式 (与您现有的 time-perception-switch 样式对齐) */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
            flex-shrink: 0; /* 防止被压缩 */
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }
        .toggle-switch .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        .toggle-switch input:checked + .slider {
            background-color: var(--primary-color);
        }
        .toggle-switch input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* API Key 输入框的显隐按钮 */
        #novelai-key-toggle {
            position: absolute;
            right: 12px; /* 调整位置以匹配 form-group 的 padding */
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            user-select: none;
            font-size: 18px;
            color: #888;
            z-index: 2; /* 确保在输入框之上 */
        }

        /* * 弹窗 UI 结构修复：
         * 移除 .modal-header, .modal-body, .modal-footer 的特定样式
         * 弹窗内容现在直接放在 .modal-window 中
        */

        /* 弹窗内的复选框和标签 */
        .nai-modal-content .form-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            vertical-align: middle;
        }
        .nai-modal-content .form-group small {
            font-size: 12px;
            color: #666;
            display: block;
            margin-top: 5px;
        }

        /* 弹窗内的关闭按钮 (匹配 index.html 弹窗的关闭按钮) */
        .nai-modal-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            line-height: 1;
            z-index: 10;
        }
        .nai-modal-close-btn:hover {
            color: #333;
        }

        /* 弹窗内容滚动区域 */
        .nai-modal-scrollable-content {
            max-height: 65vh; /* 限制内容最大高度 */
            overflow-y: auto; /* 超出时滚动 */
            padding: 15px 5px 0 5px; /* 顶部留出空间，左右微调 */
            margin: 0 -5px; /* 抵消内边距，使滚动条贴边 */
        }

        /* 测试弹窗图片预览 */
        #nai-result-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            object-fit: contain;
        }

        /* 角色/群聊设置侧边栏单选按钮 */
        #nai-character-settings-group input[type="radio"],
        #group-nai-settings-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
            vertical-align: middle;
        }
        #nai-character-settings-group label,
        #group-nai-settings-group label {
            margin-bottom: 0;
        }

        /* --- NovelAI 修复 (v3) --- */

        /* 修复：确保从侧边栏打开的弹窗层级高于侧边栏 (z-index: 101) */
        #character-nai-prompts-modal {
            z-index: 102;
        }

        /* 修复：设置弹窗中的复选框布局 */
        .nai-settings-checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px 0;
        }
        .nai-settings-checkbox-group label {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0;
        }
        .nai-settings-checkbox-group .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            margin-top: 5px;
        }
        .nai-settings-checkbox-group .checkbox-container span {
            font-size: 14px;
            color: #333;
        }
        .nai-settings-checkbox-group .checkbox-container input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
        }

